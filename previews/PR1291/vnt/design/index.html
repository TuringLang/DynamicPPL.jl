<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Design · DynamicPPL</title><meta name="title" content="Design · DynamicPPL"/><meta property="og:title" content="Design · DynamicPPL"/><meta property="twitter:title" content="Design · DynamicPPL"/><meta name="description" content="Documentation for DynamicPPL."/><meta property="og:description" content="Documentation for DynamicPPL."/><meta property="twitter:description" content="Documentation for DynamicPPL."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body>
<!-- NAVBAR START -->
<style>
    @import url('https://fonts.googleapis.com/css2?family=Source+Sans+Pro&display=swap');

    /* Documenter.jl CSS Overrides */
    html {
        scroll-padding-top: calc(var(--navbar-height) + 1rem);
    }
    .docs-sidebar, #documenter {
        margin-top: var(--navbar-height);
    }
    .docs-version-selector {
        margin-bottom: 60px !important;
    }
    @media screen and (max-width: 1056px) {
        .docs-version-selector {
            margin-bottom: 60px !important;
        }
        .docs-sidebar {
            margin-top: 0 !important;
        }
    }
    /* End of Documenter.jl Tweaks */

    /* Color and Font Variables */
    :root {
        --heading-color: #6c757d;
        --item-color: rgb(165, 165, 165);
        --primary-bg: white;
        --hover-color: #8faad2;
        --deprecated-bg: #ff4d4d;
        --deprecated-text: white;
        --icon-color: #6c757d;
        --shadow-color: rgba(0, 0, 0, 0.1);
        --dropdown-hover-bg: #e9ecef;
        
        /* Typography */
        --font-family: "Source Sans Pro", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        --nav-link-font-size: 1.0625rem;
        --turing-title-font-size: 21.25px;
        --icon-font-size: 1.25rem;
        --dropdown-arrow-font-size: 0.6875rem;
        --badge-font-size: 0.75rem;

        /* Sizing and Spacing */
        --navbar-height: 3.75rem;
        --logo-height: 31px;
        --logo-width: auto;
        --logo-padding-top: 7px;
        --logo-margin-left: 0.8rem;
        --title-margin-left: 0.4px;
        --title-nav-spacing: 1.1rem;
        --nav-item-margin-left: 1.3rem;
        --icon-margin-left: 1rem;
        --dropdown-padding: 1.875rem;
        --dropdown-item-width: 12.5rem;
        --dropdown-subitem-width: 15.625rem;
        --dropdown-subitem-padding: 0.125rem 0.625rem;
    }

    /* Dark Theme Variable Overrides */
    html.theme--documenter-dark {
        --heading-color: #e0e0e0;
        --item-color: #bdbdbd;
        --primary-bg: #1f2424;
        --hover-color: #ffffff;
        --icon-color: #e0e0e0;
        --shadow-color: rgba(255, 255, 255, 0.1);
        --dropdown-hover-bg: #424242;
    }

    /* Catppuccin Theme Overrides */
    html.theme--catppuccin-latte {
        --heading-color: #4c4f69;
        --primary-bg: #eff1f5;
        --icon-color: #4c4f69;
        --shadow-color: rgba(0, 0, 0, 0.1);
        --dropdown-hover-bg: #e6e9ef;
    }
    html.theme--catppuccin-frappe {
        --heading-color: #c6d0f5;
        --primary-bg: #303446;
        --icon-color: #c6d0f5;
        --shadow-color: rgba(255, 255, 255, 0.1);
        --dropdown-hover-bg: #51576d;
    }
    html.theme--catppuccin-macchiato {
        --heading-color: #cad3f5;
        --primary-bg: #24273a;
        --icon-color: #cad3f5;
        --shadow-color: rgba(255, 255, 255, 0.1);
        --dropdown-hover-bg: #494d64;
    }
    html.theme--catppuccin-mocha {
        --heading-color: #cad3f5;
        --primary-bg: #1e1e2e;
        --icon-color: #cad3f5;
        --shadow-color: rgba(255, 255, 255, 0.1);
        --dropdown-hover-bg: #45475a;
    }


    /* Main Navigation Bar */
    .ext-navigation {
        font-family: var(--font-family);
        position: fixed;
        height: var(--navbar-height);
        top: 0;
        width: 100%;
        background-color: var(--primary-bg);
        z-index: 1000;
        box-shadow: 0 2px 4px var(--shadow-color);
        display: flex;
        align-items: center;
        padding: 0 1.0625rem;
        transition: transform 0.3s, background-color 0.3s;
    }

    nav.ext-navigation .ext-navbar-logo {
        margin-left: var(--logo-margin-left);
        height: auto;
        max-height: var(--logo-height);
        width: auto;
        padding-top: var(--logo-padding-top);
    }
    
    /* Theme-aware logo text color */
    .ext-navbar-logo .logo-text {
        fill: var(--heading-color);
    }
    
    .ext-navbar-title {
        color: var(--heading-color) !important;
        font-size: var(--turing-title-font-size) !important;
        margin-left: var(--title-margin-left);
        text-decoration: none;
        transition: color 0.2s ease;
    }
    
    .ext-navbar-title:hover {
        color: var(--hover-color) !important;
    }

    .ext-nav-links {
        display: flex;
        align-items: center;
        list-style-type: none;
        margin: 0;
        padding: 0;
        flex-grow: 1;
        margin-left: var(--title-nav-spacing);
    }

    .ext-nav-links li:first-child {
        margin-left: 0 !important;
    }

    .ext-nav-links li {
        margin-left: var(--nav-item-margin-left) !important;
    }

    .ext-nav-link {
        color: var(--heading-color) !important;
        text-decoration: none;
        font-size: var(--nav-link-font-size) !important;
        transition: color 0.2s ease;
        cursor: pointer;
    }

    .ext-nav-link:hover,
    .ext-navbar-item-single a:hover,
    .ext-navbar-icons a:hover {
        color: var(--hover-color) !important;
    }

    .ext-navbar-item-single a {
        color: var(--heading-color) !important;
    }
    
    .ext-navbar-icons {
        display: flex;
        align-items: center;
    }

    .ext-navbar-icons a {
        color: var(--icon-color) !important;
        font-size: var(--icon-font-size) !important;
        transition: color 0.2s ease;
        margin-left: var(--icon-margin-left);
    }

    .ext-menu-toggle {
        display: none;
        font-size: 1.5rem;
        color: var(--heading-color);
        cursor: pointer;
    }

    .ext-dropdown {
        display: none;
        grid-template-columns: 1fr 1fr 1fr 1fr;
        padding: var(--dropdown-padding);
        position: absolute;
        top: var(--navbar-height);
        width: 100%;
        left: 0;
        background-color: var(--primary-bg);
        line-height: 1.875rem;
        opacity: 0;
        transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out, background-color 0.3s;
        transform: translateY(-0.625rem);
        box-shadow: 0 4px 6px var(--shadow-color);
    }

    #library-handler::after {
        content: "▼";
        font-size: var(--dropdown-arrow-font-size);
        margin-left: 0.3125rem;
        transition: transform 0.3s ease-in-out;
    }

    #library-handler.open::after {
        content: "▲";
    }

    .ext-dropdown.show {
        display: grid;
        opacity: 1;
        transform: translateY(0);
    }

    .ext-dropdown ul {
        width: var(--dropdown-item-width);
        margin-bottom: 1.25rem;
    }

    .ext-dropdown ul li {
        text-align: left;
        display: flex;
        align-items: center;
    }

    .ext-dropdown ul a li {
        color: var(--item-color);
        width: var(--dropdown-subitem-width);
        border-radius: 3px;
        padding: var(--dropdown-subitem-padding);
        transition: background-color 0.2s ease;
    }

    .ext-dropdown ul a li:hover {
        background-color: var(--dropdown-hover-bg);
    }

    .ext-dropdown-item-heading {
        color: var(--heading-color);
        text-align: center;
    }

    .deprecated-badge {
        background-color: var(--deprecated-bg);
        color: var(--deprecated-text);
        font-size: var(--badge-font-size);
        padding: .1rem;
        border-radius: 3px;
        margin-left: 0.5rem;
        line-height: 1;
    }

    @media (max-width: 966px) {
        .ext-dropdown {
            grid-template-columns: 1fr 1fr 1fr;
        }
    }

    @media (max-width: 768px) {
        .ext-nav-links {
            display: none;
            flex-direction: column;
            align-items: center;
            width: 100%;
            background-color: var(--primary-bg);
            position: absolute;
            top: var(--navbar-height);
            left: 0;
            padding: 0.625rem 0;
            height: auto;
            overflow-y: auto;
            box-shadow: 0 4px 6px var(--shadow-color);
            margin-left: 0;
        }

        .ext-nav-links.show {
            display: flex;
        }

        .ext-nav-links li {
            margin: 0.625rem 0 !important;
            text-align: center;
        }
        
        .ext-menu-toggle {
            display: block;
            margin-left: auto;
        }

        .ext-navigation.hide {
            transform: translateY(calc(-1 * var(--navbar-height)));
        }

        .ext-dropdown {
            position: static;
            display: block;
            opacity: 1;
            transform: none;
            box-shadow: none;
            grid-template-columns: 1fr;
            padding: 0.625rem;
            text-align: center;
        }

        .ext-dropdown ul {
            width: auto;
            display: inline-block;
            margin: 0 auto 0.3125rem;
            text-align: left;
        }
    }
</style>
<nav class="ext-navigation">
    <a href="https://turinglang.org/">
        <svg width="4333" height="1145" viewBox="0 0 4333 1145" fill="none" xmlns="http://www.w3.org/2000/svg" class="ext-navbar-logo">
            <path class="logo-text" d="M0.44603 193.181V66.9868H663.471V193.181H406.62V898H257.297V193.181H0.44603ZM1097.24 635.874V274.74H1244.13V898H1101.7V787.225H1095.21C1081.14 822.121 1058.01 850.66 1025.82 872.842C993.902 895.024 954.542 906.115 907.744 906.115C866.896 906.115 830.783 897.053 799.403 878.929C768.295 860.534 743.948 833.889 726.365 798.993C708.782 763.826 699.99 721.356 699.99 671.581V274.74H846.878V648.858C846.878 688.353 857.699 719.733 879.34 742.997C900.981 766.261 929.385 777.893 964.551 777.893C986.192 777.893 1007.16 772.618 1027.45 762.068C1047.73 751.518 1064.37 735.828 1077.35 714.999C1090.61 693.899 1097.24 667.524 1097.24 635.874ZM1395.17 898V274.74H1537.6V378.617H1544.09C1555.45 342.639 1574.93 314.911 1602.52 295.434C1630.38 275.687 1662.17 265.813 1697.88 265.813C1705.99 265.813 1715.05 266.219 1725.06 267.031C1735.34 267.572 1743.86 268.518 1750.63 269.871V404.992C1744.4 402.828 1734.53 400.934 1721 399.311C1707.75 397.417 1694.9 396.471 1682.46 396.471C1655.68 396.471 1631.6 402.287 1610.23 413.919C1589.13 425.28 1572.49 441.105 1560.32 461.393C1548.15 481.682 1542.06 505.081 1542.06 531.591V898H1395.17ZM1848.21 898V274.74H1995.1V898H1848.21ZM1922.06 186.283C1898.8 186.283 1878.78 178.573 1862.01 163.154C1845.24 147.464 1836.85 128.664 1836.85 106.752C1836.85 84.5701 1845.24 65.7695 1862.01 50.3503C1878.78 34.6606 1898.8 26.8158 1922.06 26.8158C1945.6 26.8158 1965.61 34.6606 1982.12 50.3503C1998.89 65.7695 2007.27 84.5701 2007.27 106.752C2007.27 128.664 1998.89 147.464 1982.12 163.154C1965.61 178.573 1945.6 186.283 1922.06 186.283ZM2293.04 532.809V898H2146.15V274.74H2286.54V380.646H2293.85C2308.18 345.75 2331.04 318.022 2362.42 297.463C2394.07 276.904 2433.16 266.625 2479.69 266.625C2522.7 266.625 2560.17 275.822 2592.09 294.217C2624.28 312.612 2649.17 339.257 2666.75 374.153C2684.6 409.049 2693.39 451.385 2693.12 501.159V898H2546.24V523.882C2546.24 482.223 2535.41 449.626 2513.77 426.092C2492.4 402.557 2462.78 390.79 2424.91 390.79C2399.21 390.79 2376.35 396.471 2356.34 407.832C2336.59 418.923 2321.03 435.019 2309.67 456.119C2298.58 477.218 2293.04 502.782 2293.04 532.809ZM3113.5 1144.71C3060.75 1144.71 3015.44 1137.54 2977.57 1123.2C2939.7 1109.13 2909.26 1090.2 2886.27 1066.39C2863.28 1042.59 2847.32 1016.21 2838.39 987.269L2970.67 955.213C2976.62 967.386 2985.28 979.424 2996.64 991.327C3008 1003.5 3023.28 1013.51 3042.49 1021.35C3061.97 1029.47 3086.45 1033.53 3115.93 1033.53C3157.59 1033.53 3192.08 1023.38 3219.4 1003.09C3246.73 983.076 3260.39 950.074 3260.39 904.087V786.008H3253.08C3245.51 801.157 3234.42 816.711 3219.81 832.671C3205.47 848.632 3186.4 862.022 3162.6 872.842C3139.06 883.663 3109.44 889.073 3073.73 889.073C3025.85 889.073 2982.44 877.847 2943.48 855.394C2904.8 832.671 2873.96 798.857 2850.97 753.952C2828.24 708.777 2816.88 652.24 2816.88 584.341C2816.88 515.902 2828.24 458.147 2850.97 411.078C2873.96 363.739 2904.93 327.896 2943.89 303.55C2982.84 278.933 3026.26 266.625 3074.14 266.625C3110.66 266.625 3140.69 272.847 3164.22 285.29C3188.03 297.463 3206.96 312.206 3221.03 329.519C3235.09 346.561 3245.78 362.657 3253.08 377.805H3261.2V274.74H3406.06V908.144C3406.06 961.435 3393.34 1005.53 3367.92 1040.42C3342.49 1075.32 3307.73 1101.43 3263.63 1118.74C3219.54 1136.05 3169.5 1144.71 3113.5 1144.71ZM3114.72 773.835C3145.83 773.835 3172.34 766.261 3194.25 751.112C3216.16 735.963 3232.79 714.187 3244.16 685.783C3255.52 657.379 3261.2 623.295 3261.2 583.53C3261.2 544.305 3255.52 509.95 3244.16 480.465C3233.07 450.979 3216.56 428.12 3194.65 411.89C3173.01 395.389 3146.37 387.138 3114.72 387.138C3081.98 387.138 3054.66 395.659 3032.75 412.701C3010.84 429.744 2994.34 453.143 2983.25 482.899C2972.16 512.385 2966.61 545.929 2966.61 583.53C2966.61 621.672 2972.16 655.08 2983.25 683.754C2994.61 712.158 3011.25 734.34 3033.16 750.3C3055.34 765.99 3082.53 773.835 3114.72 773.835ZM3647.08 906.927C3622.47 906.927 3601.37 898.271 3583.78 880.958C3566.2 863.645 3557.54 842.545 3557.82 817.658C3557.54 793.312 3566.2 772.482 3583.78 755.17C3601.37 737.857 3622.47 729.2 3647.08 729.2C3670.89 729.2 3691.58 737.857 3709.17 755.17C3727.02 772.482 3736.08 793.312 3736.35 817.658C3736.08 834.159 3731.75 849.173 3723.37 862.698C3715.25 876.224 3704.43 887.044 3690.91 895.16C3677.65 903.004 3663.04 906.927 3647.08 906.927ZM3888.01 274.74H4034.9V933.708C4034.9 978.613 4026.38 1015.67 4009.33 1044.89C3992.29 1074.1 3967.67 1095.88 3935.48 1110.22C3903.29 1124.55 3864.2 1131.72 3818.22 1131.72C3812.81 1131.72 3807.8 1131.59 3803.2 1131.32C3798.6 1131.32 3793.6 1131.18 3788.19 1130.91V1011.21C3792.25 1011.48 3795.9 1011.62 3799.15 1011.62C3802.39 1011.89 3805.77 1012.02 3809.29 1012.02C3837.42 1012.02 3857.58 1005.12 3869.75 991.327C3881.92 977.801 3888.01 957.918 3888.01 931.679V274.74ZM3961.05 186.283C3937.51 186.283 3917.36 178.573 3900.59 163.154C3884.09 147.464 3875.84 128.664 3875.84 106.752C3875.84 84.5701 3884.09 65.7695 3900.59 50.3503C3917.36 34.6606 3937.51 26.8158 3961.05 26.8158C3984.31 26.8158 4004.19 34.6606 4020.7 50.3503C4037.47 65.7695 4045.85 84.5701 4045.85 106.752C4045.85 128.664 4037.47 147.464 4020.7 163.154C4004.19 178.573 3984.31 186.283 3961.05 186.283ZM4332.83 66.9868V898H4185.94V66.9868H4332.83Z" fill="currentColor"/>
            <path d="M4076 108.5C4076 168.424 4027.42 217 3967.5 217C3907.58 217 3859 168.424 3859 108.5C3859 48.5762 3907.58 0 3967.5 0C4027.42 0 4076 48.5762 4076 108.5Z" fill="#389725"/>
            <path d="M3755 814.5C3755 874.424 3706.42 923 3646.5 923C3586.58 923 3538 874.424 3538 814.5C3538 754.576 3586.58 706 3646.5 706C3706.42 706 3755 754.576 3755 814.5Z" fill="#9457B1"/>
            <path d="M2030 108.5C2030 168.424 1981.42 217 1921.5 217C1861.58 217 1813 168.424 1813 108.5C1813 48.5762 1861.58 0 1921.5 0C1981.42 0 2030 48.5762 2030 108.5Z" fill="#CA3B33"/>
        </svg>
    </a>
    <!-- <a class="ext-navbar-title" href="https://turinglang.org/">Turing.jl</a> -->
    
    <ul class="ext-nav-links">
        <li><a class="ext-nav-link" href="https://turinglang.org/docs/getting-started/">Get Started</a></li>
        <li><a class="ext-nav-link" href="https://turinglang.org/docs/tutorials/">Tutorials</a></li>
        <li><a class="ext-nav-link" href="https://turinglang.org/docs/faq/">FAQ</a></li>
        <li>
            <p class="ext-nav-link" id="library-handler">Libraries</p>
            <div class="ext-dropdown" id="ext-dropdown-items">
                <ul>
                    <li class="ext-dropdown-item-heading">Modelling Languages</li>
                    <a href="https://turinglang.org/DynamicPPL.jl/"><li>DynamicPPL</li></a>
                    <a href="https://turinglang.org/JuliaBUGS.jl/"><li>JuliaBUGS</li></a>
                    <a href="https://turinglang.org/TuringGLM.jl/"><li>TuringGLM</li></a>
                </ul>
                <ul>
                    <li class="ext-dropdown-item-heading">MCMC</li>
                    <a href="https://turinglang.org/AdvancedHMC.jl/"><li>AdvancedHMC</li></a>
                    <a href="https://turinglang.org/AbstractMCMC.jl/"><li>AbstractMCMC</li></a>
                    <a href="https://github.com/theogf/ThermodynamicIntegration.jl"><li>ThermodynamicIntegration</li></a>
                    <a href="https://turinglang.org/AdvancedPS.jl/"><li>AdvancedPS</li></a>
                    <a href="https://turinglang.org/SliceSampling.jl/"><li>SliceSampling</li></a>
                    <a href="https://turinglang.org/EllipticalSliceSampling.jl/"><li>EllipticalSliceSampling</li></a>
                </ul>
                <ul>
                    <li class="ext-dropdown-item-heading">Diagnostics</li>
                    <a href="https://turinglang.org/MCMCChains.jl/"><li>MCMCChains</li></a>
                    <a href="https://turinglang.org/MCMCDiagnosticTools.jl/"><li>MCMCDiagnosticTools</li></a>
                    <a href="https://chalk-lab.github.io/ParetoSmooth.jl/"><li>ParetoSmooth</li></a>
                </ul>
                <ul>
                    <li class="ext-dropdown-item-heading">Gaussian Processes</li>
                    <a href="https://juliagaussianprocesses.github.io/AbstractGPs.jl/"><li>AbstractGPs</li></a>
                    <a href="https://juliagaussianprocesses.github.io/KernelFunctions.jl/"><li>KernelFunctions</li></a>
                    <a href="https://juliagaussianprocesses.github.io/ApproximateGPs.jl/"><li>ApproximateGPs</li></a>
                </ul>
                <ul><li class="ext-dropdown-item-heading ext-navbar-item-single"><a href="https://turinglang.org/Bijectors.jl/">Bijectors</a></li></ul>
                <ul><li class="ext-dropdown-item-heading ext-navbar-item-single"><a href="https://turinglang.org/TuringCallbacks.jl/">TuringCallbacks</a></li></ul>
                <ul><li class="ext-dropdown-item-heading ext-navbar-item-single"><a href="https://turinglang.org/Deprecated/TuringBenchmarking/">TuringBenchmarking</a><span class="deprecated-badge">Deprecated</span></li></ul>
            </div>
        </li>
        <li><a class="ext-nav-link" href="https://turinglang.org/news/">News</a></li>
        <li><a class="ext-nav-link" href="https://turinglang.org/team/">Team</a></li>
    </ul>

    <div class="ext-navbar-icons">
        <a href="https://x.com/TuringLang" aria-label="Turing on X"><i class="fa-brands fa-x-twitter"></i></a>
        <a href="https://discourse.julialang.org/c/domain/probprog/48" aria-label="Turing on Discourse"><i class="fa-brands fa-discourse"></i></a>
        <a href="https://julialang.slack.com/archives/CCYDC34A0" aria-label="Turing on Slack"><i class="fa-brands fa-slack"></i></a>
        <a href="https://github.com/TuringLang/" aria-label="Turing.jl on GitHub"><i class="fa-brands fa-github"></i></a>
    </div>

    <span class="ext-menu-toggle"><i class="fa-solid fa-bars"></i></span>
</nav>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const menuToggle = document.querySelector(".ext-menu-toggle");
        const navLinks = document.querySelector(".ext-nav-links");
        const nav = document.querySelector(".ext-navigation");
        const libraryHandler = document.getElementById("library-handler");
        const dropdownContainer = document.getElementById("ext-dropdown-items");
        let lastScrollY = window.scrollY;

        function closeDropdown() {
            if (dropdownContainer.classList.contains("show")) {
                libraryHandler.classList.remove("open");
                dropdownContainer.classList.remove("show");
                setTimeout(() => {
                    if (!dropdownContainer.classList.contains("show")) {
                        dropdownContainer.style.display = "none";
                    }
                }, 300);
            }
        }

        function openDropdown() {
            dropdownContainer.style.display = "grid";
            libraryHandler.classList.add("open");
            setTimeout(() => {
                dropdownContainer.classList.add("show");
            }, 10);
        }

        function setAppropriateHeight() {
            if (window.innerWidth <= 768) {
                const viewportHeight = window.innerHeight;
                const navHeight = nav.offsetHeight;
                navLinks.style.maxHeight = `${viewportHeight - navHeight}px`;
                navLinks.style.overflowY = "auto";
            } else {
                navLinks.style.maxHeight = "";
                navLinks.style.overflowY = "";
            }
        }

        menuToggle.addEventListener("click", (event) => {
            event.stopPropagation();
            navLinks.classList.toggle("show");
            if (navLinks.classList.contains("show")) {
                setAppropriateHeight();
                closeDropdown();
                dropdownContainer.style.display = "none";
            }
        });

        libraryHandler.addEventListener("click", (event) => {
            event.stopPropagation();
            event.preventDefault();
            if (dropdownContainer.classList.contains("show")) {
                closeDropdown();
            } else {
                openDropdown();
            }
            setAppropriateHeight();
        });

        // Close all menus if a click is registered outside the navigation bar.
        document.addEventListener("click", (event) => {
            if (!nav.contains(event.target)) {
                navLinks.classList.remove("show");
                closeDropdown();
            }
        });

        // Hide navigation bar on scroll down in mobile view.
        window.addEventListener("scroll", () => {
            if (window.innerWidth <= 768) {
                if (window.scrollY > lastScrollY && window.scrollY > nav.offsetHeight){
                    nav.classList.add("hide");
                } else {
                    nav.classList.remove("hide");
                }
                lastScrollY = window.scrollY;
            }
        });

        window.addEventListener("resize", setAppropriateHeight);
    });
</script>
<!-- NAVBAR END -->



<div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="DynamicPPL logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DynamicPPL</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../conditionfix/">Conditioning and fixing</a></li><li><span class="tocitem">VarNamedTuple</span><ul><li><a class="tocitem" href="../motivation/">Motivation</a></li><li class="is-active"><a class="tocitem" href>Design</a><ul class="internal"><li><a class="tocitem" href="#Property-access"><span>Property access</span></a></li><li><a class="tocitem" href="#Indexing-and-PartialArrays"><span>Indexing and <code>PartialArray</code>s</span></a></li><li><a class="tocitem" href="#GrowableArrays"><span><code>GrowableArray</code>s</span></a></li><li><a class="tocitem" href="#Templated-arrays"><span>Templated arrays</span></a></li><li><a class="tocitem" href="#How-do-we-provide-the-template?"><span>How do we provide the template?</span></a></li></ul></li><li><a class="tocitem" href="../implementation/">Implementation</a></li><li><a class="tocitem" href="../arraylikeblocks/">Array-like blocks</a></li></ul></li><li><a class="tocitem" href="../../evaluation/">Model evaluation</a></li><li><a class="tocitem" href="../../tilde/">Tilde-statements</a></li><li><a class="tocitem" href="../../init/">Initialisation strategies</a></li><li><a class="tocitem" href="../../transforms/">Transform strategies</a></li><li><span class="tocitem">Accumulators</span><ul><li><a class="tocitem" href="../../accs/overview/">Overview</a></li><li><a class="tocitem" href="../../accs/existing/">Existing accumulators in DynamicPPL</a></li><li><a class="tocitem" href="../../accs/threadsafe/">Thread-safe accumulation</a></li><li><a class="tocitem" href="../../accs/values/">Storing vectorised vs. raw values</a></li></ul></li><li><span class="tocitem">LogDensityFunction</span><ul><li><a class="tocitem" href="../../ldf/overview/">Overview</a></li><li><a class="tocitem" href="../../ldf/models/">Using LDFs in model evaluation</a></li></ul></li><li><a class="tocitem" href="../../migration/">Migrating old VarInfo code</a></li><li><a class="tocitem" href="../../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">VarNamedTuple</a></li><li class="is-active"><a href>Design</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Design</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/TuringLang/DynamicPPL.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/TuringLang/DynamicPPL.jl/blob/main/docs/src/vnt/design.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Design"><a class="docs-heading-anchor" href="#Design">Design</a><a id="Design-1"></a><a class="docs-heading-anchor-permalink" href="#Design" title="Permalink"></a></h1><p>There are two aspects to the design of <code>VarNamedTuple</code>s: property access, and indexing. <code>VarNamedTuple</code> consists of recursively nested <code>NamedTuple</code>s and <code>PartialArray</code>s which together support both kinds of access.</p><h2 id="Property-access"><a class="docs-heading-anchor" href="#Property-access">Property access</a><a id="Property-access-1"></a><a class="docs-heading-anchor-permalink" href="#Property-access" title="Permalink"></a></h2><p>Let&#39;s first talk about the <code>NamedTuple</code> part. In a <code>VarNamedTuple</code> each level of a <code>Property</code> optic corresponds to a level of nested <code>NamedTuple</code>s, with the <code>Symbol</code>s of the lenses as keys. For instance, the <code>VarNamedTuple</code> mapping <code>@varname(x) =&gt; 1, @varname(y.z) =&gt; 2</code> would be stored as</p><pre><code class="language-julia hljs">VarNamedTuple(; x=1, y=VarNamedTuple(; z=2))</code></pre><p>where <code>VarNamedTuple(; x=a, y=b)</code> is just a thin wrapper around the <code>NamedTuple</code> <code>(; x=a, y=b)</code>. In fact, if <code>vnt</code> is a <code>VarNamedTuple</code>, then <code>vnt.data</code> is exactly that underlying <code>NamedTuple</code>.</p><p>It&#39;s often handy to think of this as a tree, with each node being a <code>VarNamedTuple</code>, like so:</p><pre><code class="nohighlight hljs">   VNT
x /   \ y
 1     VNT
         \ z
          2</code></pre><p>By virtue of these being <code>NamedTuple</code>, all variable access is completely type-stable.</p><p>If all <code>VarName</code>s consisted of only <code>Property</code>es we would be done designing the data structure. Sadly, that isn&#39;t the case!</p><h2 id="Indexing-and-PartialArrays"><a class="docs-heading-anchor" href="#Indexing-and-PartialArrays">Indexing and <code>PartialArray</code>s</a><a id="Indexing-and-PartialArrays-1"></a><a class="docs-heading-anchor-permalink" href="#Indexing-and-PartialArrays" title="Permalink"></a></h2><p>Indexing is much more complicated to handle than property access, for a number of reasons.</p><p>Let&#39;s start by talking about the most obvious issue: only some parts of an array may be set. For example, the user may set <code>x[1]</code> and <code>x[10]</code> but not the ones in the middle. This is accomplished using a <code>PartialArray</code>, which is a wrapper around an <code>AbstractArray</code> that holds the data of interest, together with a mask saying which elements have been set.</p><p>The array type and size of the mask is always the same as the data array (this is done using <code>Base.similar</code>).</p><div class="admonition is-info" id="Info-b1f4fe5abca43510"><header class="admonition-header">Info<a class="admonition-anchor" href="#Info-b1f4fe5abca43510" title="Permalink"></a></header><div class="admonition-body"><p>Currently this is not enforced in an inner constructor, because that sometimes leads to extra allocations. It would be nice to investigate if this invariant can be enforced.</p></div></div><p>If <code>pa.mask[i]</code> is <code>true</code>, then <code>pa.data[i]</code> has been set; otherwise, <code>pa.data[i]</code> may contain some value, but it is not valid to index into that part of the array.</p><p>Here is an example:</p><pre><code class="language-julia hljs">using DynamicPPL.VarNamedTuples: PartialArray

data = randn(3)
mask = similar(data, Bool)
fill!(mask, false)
pa = PartialArray(data, mask)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PartialArray <span class="sgr90">size=(3,)</span> data::Vector{Float64}
</code></pre><p>The main way of interacting with a <code>PartialArray</code> is to use <code>BangBang.setindex!!</code>. This sets one or more elements of the <code>PartialArray</code>&#39;s data, and marks the corresponding elements in the mask as <code>true</code>.</p><pre><code class="language-julia hljs">using BangBang: setindex!!

setindex!!(pa, 12.0, 2)
pa.data, pa.mask</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">([-0.180784208125425, 12.0, 1.0609623427180095], Bool[0, 1, 0])</code></pre><p>When printed, <code>pa</code> shows only the elements that are set:</p><pre><code class="language-julia hljs">pa</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PartialArray <span class="sgr90">size=(3,)</span> data::Vector{Float64}
└─ <span class="sgr36">(2,)</span> =&gt; 12.0</code></pre><p>It is invalid to index into the unset elements:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; pa[1]</code><code class="nohighlight hljs ansi" style="display:block;">ERROR: BoundsError: attempt to access DynamicPPL.VarNamedTuples.PartialArray{Float64, 1, Vector{Float64}, Vector{Bool}} at index [1, Base.Pairs{Symbol, Union{}, Nothing, @NamedTuple{}}()]</code></pre><p>but you can access the set elements:</p><pre><code class="language-julia hljs">pa[2]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">12.0</code></pre><p>It follows from this, that because the <code>PartialArray</code> <em>is</em> actually backed by a regular <code>Array</code>, it is constructive. The call to <code>getindex</code> will return the values stored in <code>pa.data</code>, as long as all the elements in <code>pa.mask</code> are set. For example:</p><pre><code class="language-julia hljs">setindex!!(pa, 11.0, 1)
pa[1:2]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2-element Vector{Float64}:
 11.0
 12.0</code></pre><p>You can even get the entirety of the array, once you have set all three elements. In this case, the <code>PartialArray</code> is (morally) equivalent to a single <code>Array</code>.</p><pre><code class="language-julia hljs">setindex!!(pa, 13.0, 3)
pa[:]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3-element Vector{Float64}:
 11.0
 12.0
 13.0</code></pre><p>All <code>Index</code> optics in <code>VarName</code>s correspond to <code>PartialArray</code>s in <code>VarNamedTuple</code>s. For example, let&#39;s say we want to store the mappings <code>@varname(x[1].a) =&gt; 1.0</code>, and <code>y.b[2,3] =&gt; 2.0</code>. The corresponding <code>VarNamedTuple</code> would look like this:</p><pre><code class="nohighlight hljs">         VNT
        /   \y  
      x/     \    b
      /     VNT------PA[[ _, _, _  ],
     /                  [ _, _, 2.0]]
    PA [VNT]
         |
        a|
         |
        1.0</code></pre><p>where <code>_</code> indicates masked elements in a <code>PartialArray</code>. To demonstrate:</p><pre><code class="language-julia hljs">using DynamicPPL

vnt = VarNamedTuple()
vnt = setindex!!(vnt, 1.0, @varname(x[1].a))
vnt = setindex!!(vnt, 2.0, @varname(y.b[2, 3]))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">VarNamedTuple
├─ <span class="sgr36">x</span> =&gt; PartialArray size=(1,) data::DynamicPPL.VarNamedTuples.GrowableArray{VarNamedTuple{(:a,), Tuple{Float64}}, 1}
│       └─ <span class="sgr31">(1,)</span> =&gt; VarNamedTuple
│                  └─ <span class="sgr32">a</span> =&gt; 1.0
└─ <span class="sgr36">y</span> =&gt; VarNamedTuple
        └─ <span class="sgr31">b</span> =&gt; PartialArray <span class="sgr90">size=(2, 3)</span> data::DynamicPPL.VarNamedTuples.GrowableArray{Float64, 2}
                └─ <span class="sgr32">(2, 3)</span> =&gt; 2.0</code></pre><pre><code class="language-julia hljs">vnt.data.x  # This is a PartialArray</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PartialArray size=(1,) data::DynamicPPL.VarNamedTuples.GrowableArray{VarNamedTuple{(:a,), Tuple{Float64}}, 1}
└─ <span class="sgr36">(1,)</span> =&gt; VarNamedTuple
           └─ <span class="sgr31">a</span> =&gt; 1.0</code></pre><pre><code class="language-julia hljs">vnt.data.x.data[1]   # This is a VNT</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">VarNamedTuple
└─ <span class="sgr36">a</span> =&gt; 1.0</code></pre><pre><code class="language-julia hljs">vnt.data.x.data[1].data.a  # This is 1.0</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1.0</code></pre><pre><code class="language-julia hljs">vnt.data.y  # This is a VNT</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">VarNamedTuple
└─ <span class="sgr36">b</span> =&gt; PartialArray <span class="sgr90">size=(2, 3)</span> data::DynamicPPL.VarNamedTuples.GrowableArray{Float64, 2}
        └─ <span class="sgr31">(2, 3)</span> =&gt; 2.0</code></pre><pre><code class="language-julia hljs">vnt.data.y.data.b  # This is a PartialArray</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PartialArray <span class="sgr90">size=(2, 3)</span> data::DynamicPPL.VarNamedTuples.GrowableArray{Float64, 2}
└─ <span class="sgr36">(2, 3)</span> =&gt; 2.0</code></pre><pre><code class="language-julia hljs">vnt.data.y.data.b.data[2, 3]  # This is 2.0</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2.0</code></pre><p>This illustrates the fundamental structure of <code>VarNamedTuple</code>s. From this example, one can see that getting data from a <code>VarNamedTuple</code> is as type-stable as possible:</p><ul><li>All property accesses are <code>NamedTuple</code> accesses, which are type-stable.</li><li>All indexing is done into <code>PartialArray</code>s: as long as indexing into the underlying data is type-stable (i.e., the element type of the data array is concrete), indexing into the <code>PartialArray</code> is type-stable as well.</li></ul><div class="admonition is-info" id="Info-5fe3cbf5716a160b"><header class="admonition-header">Info<a class="admonition-anchor" href="#Info-5fe3cbf5716a160b" title="Permalink"></a></header><div class="admonition-body"><p>In fact, the underlying data need not all have the same (concrete) type: all that is needed is that the <em>unmasked</em> elements have the same (concrete) type. The function <code>_concretise_eltype!!</code> is an attempt to force this to be the case: if the element type is abstract, but all the set elements have the same concrete type, the entire data array&#39;s element type will be changed to that concrete type (with junk in the unset elements).</p></div></div><p><strong>One immediate question here is: how do we know what kind of array the <code>PartialArray</code> should use for its data and mask?</strong></p><h2 id="GrowableArrays"><a class="docs-heading-anchor" href="#GrowableArrays"><code>GrowableArray</code>s</a><a id="GrowableArrays-1"></a><a class="docs-heading-anchor-permalink" href="#GrowableArrays" title="Permalink"></a></h2><p>It&#39;s not obvious in the code above, but in the example above, we are implicitly making an assumption based on the indices that we see in the <code>VarName</code>s. For example, for <code>@varname(x[1].a)</code>, based on the index <code>1</code> we assume that <code>x</code> should be a vector with a length of at least 1. Similarly, for <code>@varname(y.b[2,3])</code>, we assume that <code>y.b</code> should be a matrix with at least 2 rows and 3 columns.</p><p>We can inspect this by looking into the <code>PartialArray</code>s:</p><pre><code class="language-julia hljs">vnt.data.x.data</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1-element DynamicPPL.VarNamedTuples.GrowableArray{VarNamedTuple{(:a,), Tuple{Float64}}, 1}:
 VarNamedTuple(a = 1.0,)</code></pre><pre><code class="language-julia hljs">vnt.data.y.data.b.data</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2×3 DynamicPPL.VarNamedTuples.GrowableArray{Float64, 2}:
 5.0e-324  0.0  6.91787e-310
 5.0e-324  0.0  2.0</code></pre><p>So, these <code>PartialArray</code>s are backed by something called <code>GrowableArray</code>. A <code>GrowableArray</code> is an array type, defined in DynamicPPL, that can grow in size as needed when <code>setindex!!</code> is called with indices outside of its current bounds (with other arrays that would error). The reason for such an array type is that you may want to do something like</p><pre><code class="language-julia hljs">begin
    local vnt = VarNamedTuple()
    for i in 1:5
        vnt = setindex!!(vnt, i, @varname(x[i]))
    end
    vnt
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">VarNamedTuple
└─ <span class="sgr36">x</span> =&gt; PartialArray size=(5,) data::DynamicPPL.VarNamedTuples.GrowableArray{Int64, 1}
        ├─ <span class="sgr31">(1,)</span> =&gt; 1
        ├─ <span class="sgr31">(2,)</span> =&gt; 2
        ├─ <span class="sgr31">(3,)</span> =&gt; 3
        ├─ <span class="sgr31">(4,)</span> =&gt; 4
        └─ <span class="sgr31">(5,)</span> =&gt; 5</code></pre><p>and we don&#39;t have the ability to know in advance that <code>x</code> will eventually need to be at least of size 5. So, every call to <code>setindex!!</code> here will cause the underlying <code>GrowableArray</code> to grow in size as needed.</p><p>The problem with this is that it makes a huge number of implicit assumptions about what kind of array <code>x</code> <em>actually</em> is, and consequently it forbids a huge number of indexing operations in Julia.</p><p>These include, for example, linear indexing. In this example, the first call will create a <code>GrowableArray</code> with one dimension (i.e., a vector); and the second call will fail since we can&#39;t index a vector with two indices.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; vnt = setindex!!(VarNamedTuple(), 10.0, @varname(x[1]))</code><code class="nohighlight hljs ansi" style="display:block;">┌ Warning: Creating a growable `Base.Array` of dimension 1 to store values. This may not match the actual type or size of the actual `AbstractArray` that will be used inside the DynamicPPL model.
│ 
│  If this is not the type or size that you expect, please see: https://turinglang.org/docs/uri/growablearray
└ @ DynamicPPL.VarNamedTuples ~/work/DynamicPPL.jl/DynamicPPL.jl/src/varnamedtuple/partial_array.jl:796
VarNamedTuple
└─ <span class="sgr36">x</span> =&gt; PartialArray size=(1,) data::DynamicPPL.VarNamedTuples.GrowableArray{Float64, 1}
        └─ <span class="sgr31">(1,)</span> =&gt; 10.0</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; vnt = setindex!!(vnt, 20.0, @varname(x[2, 2]))</code><code class="nohighlight hljs ansi" style="display:block;">ERROR: ArgumentError: Cannot expand a GrowableArray with 1 dimensions using an index with 2 dimensions. GrowableArrays are created when no template is provided when setting VarNames with indices, e.g. `@varname(x[1])`, which causes DynamicPPL to have no knowledge of the shape of `x`. To fix this, you should provide a template for `x` when creating the VarNamedTuple. Alternatively, if `x` is an array with `N` dimensions, you should always index into it with `N` indices. This means avoiding using, for example, a mixture of linear and Cartesian indexing for arrays with more than one dimension.</code></pre><p>Colons also don&#39;t work.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; vnt = setindex!!(VarNamedTuple(), randn(2), @varname(x[:]))</code><code class="nohighlight hljs ansi" style="display:block;">ERROR: ArgumentError: Attempted to set a value with an index of Colon(), but no template was provided for the array. For such an index, a template is needed to determine the shape and type of the array so that the indexed data can be stored correctly.</code></pre><p>Other things like <code>OffsetArray</code>s don&#39;t work (because <code>x[11]</code> would create a length-11 <code>GrowableArray</code>, which might not be appropriate; and <code>x[-1]</code> will just straight-up error). <code>DimArray</code>s will also fail if you use an index that isn&#39;t an integer.</p><p>Finally, we don&#39;t know how large the final size of the array should be. If you try to access the entire array after setting some elements, it will work, but it will warn you:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; vnt = setindex!!(VarNamedTuple(), 10.0, @varname(x[1]))</code><code class="nohighlight hljs ansi" style="display:block;">┌ Warning: Creating a growable `Base.Array` of dimension 1 to store values. This may not match the actual type or size of the actual `AbstractArray` that will be used inside the DynamicPPL model.
│ 
│  If this is not the type or size that you expect, please see: https://turinglang.org/docs/uri/growablearray
└ @ DynamicPPL.VarNamedTuples ~/work/DynamicPPL.jl/DynamicPPL.jl/src/varnamedtuple/partial_array.jl:796
VarNamedTuple
└─ <span class="sgr36">x</span> =&gt; PartialArray size=(1,) data::DynamicPPL.VarNamedTuples.GrowableArray{Float64, 1}
        └─ <span class="sgr31">(1,)</span> =&gt; 10.0</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; vnt[@varname(x)]</code><code class="nohighlight hljs ansi" style="display:block;">┌ Warning: Returning a `Base.Array` with a presumed size based on the indices used to set values; but this may not be the actual type or size of the actual `AbstractArray` that was inside the DynamicPPL model. You should inspect the returned result to make sure that it has the correct value.
│ 
│ To find out how to avoid this warning, please see: https://turinglang.org/docs/uri/growablearray
└ @ DynamicPPL.VarNamedTuples ~/work/DynamicPPL.jl/DynamicPPL.jl/src/varnamedtuple/partial_array.jl:785
1-element Vector{Float64}:
 10.0</code></pre><h2 id="Templated-arrays"><a class="docs-heading-anchor" href="#Templated-arrays">Templated arrays</a><a id="Templated-arrays-1"></a><a class="docs-heading-anchor-permalink" href="#Templated-arrays" title="Permalink"></a></h2><p><strong>The general solution to this problem is for the user to provide a template for the array <code>x</code> in advance, so that we know what kind of array to create when we see <code>@varname(x[...])</code>.</strong></p><p>At a low level, this is done using the <a href="../../api/#DynamicPPL.VarNamedTuples.templated_setindex!!"><code>DynamicPPL.templated_setindex!!</code></a> function, which takes an extra argument that specifies the shape of the top-level symbol in the <code>VarName</code>.</p><p>For example, the linear-indexing example above now works if you tell the function that <code>x</code> is a 2-by-2 matrix.</p><pre><code class="language-julia hljs">using DynamicPPL: templated_setindex!!

x = zeros(2, 2)
vnt = VarNamedTuple()
vnt = templated_setindex!!(VarNamedTuple(), 10.0, @varname(x[1]), x)
vnt = setindex!!(vnt, 20.0, @varname(x[2, 2]))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">VarNamedTuple
└─ <span class="sgr36">x</span> =&gt; PartialArray <span class="sgr90">size=(2, 2)</span> data::Matrix{Float64}
        ├─ <span class="sgr31">(1, 1)</span> =&gt; 10.0
        └─ <span class="sgr31">(2, 2)</span> =&gt; 20.0</code></pre><p>(The second call can also be <code>templated_setindex!!</code>, but it isn&#39;t necessary since the first call already establishes the shape of <code>x</code>, and indeed in such a case the template will be ignored.) Notice that the <code>PartialArray</code> is now backed by the correct Array:</p><pre><code class="language-julia hljs">vnt.data.x.data</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2×2 Matrix{Float64}:
 10.0            6.91785e-310
  6.91785e-310  20.0</code></pre><p>It is no longer growable, so if you try to set an out-of-bounds index, it will error:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; vnt = setindex!!(vnt, 30.0, @varname(x[3, 1]))</code><code class="nohighlight hljs ansi" style="display:block;">ERROR: BoundsError: attempt to access 2×2 Matrix{Float64} at index [3, 1]</code></pre><p>This mechanism makes it far more flexible to work with arrays in DynamicPPL models. <em>Fundamentally, this resolves the inconsistency between indexing semantics in the model, and indexing semantics inside the <code>VarNamedTuple</code>.</em></p><p>For example, you can use <code>DimArray</code>s:</p><pre><code class="language-julia hljs">import DimensionalData as DD

x = DD.DimArray(zeros(2, 3), (DD.X, DD.Y))

vnt = VarNamedTuple()
vnt = templated_setindex!!(vnt, 1.0, @varname(x[DD.X(1), DD.Y(2)]), x)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">VarNamedTuple
└─ <span class="sgr36">x</span> =&gt; PartialArray <span class="sgr90">size=(2, 3)</span> data::DimensionalData.DimMatrix{Float64, Tuple{DimensionalData.Dimensions.X{DimensionalData.Dimensions.Lookups.NoLookup{Base.OneTo{Int64}}}, DimensionalData.Dimensions.Y{DimensionalData.Dimensions.Lookups.NoLookup{Base.OneTo{Int64}}}}, Tuple{}, Matrix{Float64}, DimensionalData.NoName, DimensionalData.Dimensions.Lookups.NoMetadata}
        └─ <span class="sgr31">(1, 2)</span> =&gt; 1.0</code></pre><pre><code class="language-julia hljs">vnt.data.x.data</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr90">┌ </span><span class="sgr38_5" style="color:#ff875f">2</span>×<span class="sgr38_5" style="color:#0087d7">3</span> DimArray{Float64, 2}<span class="sgr90"> ┐</span>
<span class="sgr90">├──────────────────── dims ┤</span>
  <span class="sgr38_5" style="color:#ff875f">↓ X</span>, <span class="sgr38_5" style="color:#0087d7">→ Y</span>
<span class="sgr90">└──────────────────────────┘</span>
 5.0e-324  1.0  6.91786e-310
 5.0e-324  0.0  6.91787e-310</code></pre><p>You can access the data back again in any way you like, for example using linear indexing here:</p><pre><code class="language-julia hljs">getindex(vnt, @varname(x[3]))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1.0</code></pre><div class="admonition is-info" id="Info-2d6afbc5ddeb4091"><header class="admonition-header">Info<a class="admonition-anchor" href="#Info-2d6afbc5ddeb4091" title="Permalink"></a></header><div class="admonition-body"><p>Note that support for such arrays is contingent on the provider of the array type, as well as BangBang.jl. There may be bugs that prevent some array types from fully working correctly. For example, <code>BangBang.setindex!!</code> does not accept keyword arguments, which precludes the use of keyword indices in <code>DimArray</code>s. However, DynamicPPL itself does not inherently prevent you from using such arrays. We would definitely like to fix upstream issues like these, but we don&#39;t always have the time to do so: help is <em>very</em> greatly appreciated!</p></div></div><h2 id="How-do-we-provide-the-template?"><a class="docs-heading-anchor" href="#How-do-we-provide-the-template?">How do we provide the template?</a><a id="How-do-we-provide-the-template?-1"></a><a class="docs-heading-anchor-permalink" href="#How-do-we-provide-the-template?" title="Permalink"></a></h2><p>At this point, it would seem like a major faff for users to have to provide templates any time they wanted to use a <code>VarNamedTuple</code>. The good news is, within a DynamicPPL model, <strong>the template always exists</strong>. For example, consider:</p><pre><code class="language-julia hljs">using Distributions
@model function bad_index()
    return x[1] ~ Normal()
end</code></pre><p>If you were to attempt to execute this model, even without any interaction with <code>VarNamedTuple</code>s, this would error, because <em>there is no array <code>x</code> to set the first element in</em>. It would be like writing a function that does <code>x[1] = 10</code> without ever defining <code>y</code>:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; function bad_index_not_model()
           return x[1] = 10
       end</code><code class="nohighlight hljs ansi" style="display:block;">bad_index_not_model (generic function with 1 method)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; bad_index_not_model()</code><code class="nohighlight hljs ansi" style="display:block;">10</code></pre><p>The model can <strong>only</strong> work if <code>x</code> is already provided, e.g. as an argument or a variable inside the model:</p><pre><code class="language-julia hljs">@model function ok_index1(x::AbstractArray)
    return x[1] ~ Normal()
end

@model function ok_index2()
    x = Vector{Float64}(undef, 10)
    return x[1] ~ Normal()
end</code></pre><p>In both cases, we <strong>do</strong> have access to the template for <code>x</code>. Thus, this is just a matter of plumbing this information through to <code>DynamicPPL.tilde_assume!!</code> so that it can be used when setting values in the <code>VarNamedTuple</code>. In the macro output below, you can see that <code>x</code> is passed as one of the arguments to <code>tilde_assume!!</code>.</p><pre><code class="language-julia hljs">@macroexpand @model function bad_index()
    return x[1] ~ Normal()
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">quote
    function bad_index(__model__::Model, __varinfo__::AbstractVarInfo; )
        <span class="sgr90">#= design.md:331 =#</span>
        begin
            <span class="sgr90">#= design.md:331 =#</span>
            <span class="sgr90">#= design.md:332 =#</span>
            begin
                <span class="sgr90">#= /home/runner/work/DynamicPPL.jl/DynamicPPL.jl/src/compiler.jl:621 =#</span>
                var&quot;##retval#490&quot; = begin
                        var&quot;##dist#487&quot; = Normal()
                        var&quot;##vn#484&quot; = (DynamicPPL.resolve_varnames)((VarName){:x}((Index)((1,), (;), (Iden)())), var&quot;##dist#487&quot;)
                        var&quot;##isassumption#485&quot; = begin
                                if (DynamicPPL.contextual_isassumption)(__model__.context, (DynamicPPL.prefix)(__model__.context, var&quot;##vn#484&quot;))
                                    if !((DynamicPPL.inargnames)(var&quot;##vn#484&quot;, __model__)) || (DynamicPPL.inmissings)(var&quot;##vn#484&quot;, __model__)
                                        true
                                    else
                                        (Base.maybeview)(x, 1) === missing
                                    end
                                else
                                    false
                                end
                            end
                        if (DynamicPPL.contextual_isfixed)(__model__.context, (DynamicPPL.prefix)(__model__.context, var&quot;##vn#484&quot;)) &amp;&amp; !(var&quot;##dist#487&quot; isa DynamicPPL.Submodel)
                            x = (Accessors.set)(x, (AbstractPPL.with_mutation)((AbstractPPL.getoptic)(var&quot;##vn#484&quot;)), (DynamicPPL.getfixed_nested)(__model__.context, (DynamicPPL.prefix)(__model__.context, var&quot;##vn#484&quot;)))
                        elseif var&quot;##isassumption#485&quot;
                            begin
                                (var&quot;##value#489&quot;, __varinfo__) = (DynamicPPL.tilde_assume!!)(__model__.context, (DynamicPPL.unwrap_right_vn)((DynamicPPL.check_tilde_rhs)(var&quot;##dist#487&quot;), var&quot;##vn#484&quot;)..., x, __varinfo__)
                                x = (Accessors.set)(x, (AbstractPPL.with_mutation)((AbstractPPL.getoptic)(var&quot;##vn#484&quot;)), var&quot;##value#489&quot;)
                                var&quot;##value#489&quot;
                            end
                        else
                            var&quot;##supplied_val#488&quot; = if (DynamicPPL.inargnames)(var&quot;##vn#484&quot;, __model__)
                                    (Base.maybeview)(x, 1)
                                else
                                    (DynamicPPL.getconditioned_nested)(__model__.context, (DynamicPPL.prefix)(__model__.context, var&quot;##vn#484&quot;))
                                end
                            (var&quot;##value#486&quot;, __varinfo__) = (DynamicPPL.tilde_observe!!)(__model__.context, (DynamicPPL.check_tilde_rhs)(var&quot;##dist#487&quot;), var&quot;##supplied_val#488&quot;, var&quot;##vn#484&quot;, x, __varinfo__)
                            x = (Accessors.set)(x, (AbstractPPL.with_mutation)((AbstractPPL.getoptic)(var&quot;##vn#484&quot;)), var&quot;##value#486&quot;)
                            var&quot;##value#486&quot;
                        end
                    end
                <span class="sgr90">#= /home/runner/work/DynamicPPL.jl/DynamicPPL.jl/src/compiler.jl:622 =#</span>
                return (var&quot;##retval#490&quot;, __varinfo__)
            end
        end
    end
    begin
        $(Expr(:meta, :doc))
        function bad_index(; )
            <span class="sgr90">#= design.md:331 =#</span>
            return (Model){false}(bad_index, NamedTuple{()}(()); )
        end
    end
end</code></pre><p>What this means is that in the core use case of VarNamedTuple (i.e., for storing random variables in DynamicPPL models), templates will always be provided. There are, for the most part, only two places where templates are unavailable, and we have to fall back on the <code>GrowableArray</code> approach:</p><ul><li>Loading data from chains.</li><li>Providing conditioned or fixed values.</li></ul><p>The first of these can be fixed by rerunning the model once to pick up the templates. The second cannot be truly fixed, but the <a href="../../api/#DynamicPPL.VarNamedTuples.@vnt"><code>DynamicPPL.@vnt</code></a> macro allows users to manually provide templates themselves in cases where they are really needed.</p><script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
mermaid.initialize({
    startOnLoad: true,
    theme: "neutral"
});
</script></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../motivation/">« Motivation</a><a class="docs-footer-nextpage" href="../implementation/">Implementation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.17.0 on <span class="colophon-date" title="Wednesday 25 February 2026 00:31">Wednesday 25 February 2026</span>. Using Julia version 1.12.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
