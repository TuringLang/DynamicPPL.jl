<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Design of VarInfo · DynamicPPL</title><meta name="title" content="Design of VarInfo · DynamicPPL"/><meta property="og:title" content="Design of VarInfo · DynamicPPL"/><meta property="twitter:title" content="Design of VarInfo · DynamicPPL"/><meta name="description" content="Documentation for DynamicPPL."/><meta property="og:description" content="Documentation for DynamicPPL."/><meta property="twitter:description" content="Documentation for DynamicPPL."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body>
<!-- NAVBAR START -->
<style>
    @import url('https://fonts.googleapis.com/css2?family=Source+Sans+Pro&display=swap');

    /* Documenter.jl CSS Overrides */
    html {
        scroll-padding-top: calc(var(--navbar-height) + 1rem);
    }
    .docs-sidebar, #documenter {
        margin-top: var(--navbar-height);
    }
    .docs-version-selector {
        margin-bottom: 60px !important;
    }
    @media screen and (max-width: 1056px) {
        .docs-version-selector {
            margin-bottom: 60px !important;
        }
        .docs-sidebar {
            margin-top: 0 !important;
        }
    }
    /* End of Documenter.jl Tweaks */

    /* Color and Font Variables */
    :root {
        --heading-color: #6c757d;
        --item-color: rgb(165, 165, 165);
        --primary-bg: white;
        --hover-color: #8faad2;
        --deprecated-bg: #ff4d4d;
        --deprecated-text: white;
        --icon-color: #6c757d;
        --shadow-color: rgba(0, 0, 0, 0.1);
        --dropdown-hover-bg: #e9ecef;
        
        /* Typography */
        --font-family: "Source Sans Pro", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        --nav-link-font-size: 1.0625rem;
        --turing-title-font-size: 21.25px;
        --icon-font-size: 1.25rem;
        --dropdown-arrow-font-size: 0.6875rem;
        --badge-font-size: 0.75rem;

        /* Sizing and Spacing */
        --navbar-height: 3.75rem;
        --logo-height: 31px;
        --logo-width: auto;
        --logo-padding-top: 7px;
        --logo-margin-left: 0.8rem;
        --title-margin-left: 0.4px;
        --title-nav-spacing: 1.1rem;
        --nav-item-margin-left: 1.3rem;
        --icon-margin-left: 1rem;
        --dropdown-padding: 1.875rem;
        --dropdown-item-width: 12.5rem;
        --dropdown-subitem-width: 15.625rem;
        --dropdown-subitem-padding: 0.125rem 0.625rem;
    }

    /* Dark Theme Variable Overrides */
    html.theme--documenter-dark {
        --heading-color: #e0e0e0;
        --item-color: #bdbdbd;
        --primary-bg: #1f2424;
        --hover-color: #ffffff;
        --icon-color: #e0e0e0;
        --shadow-color: rgba(255, 255, 255, 0.1);
        --dropdown-hover-bg: #424242;
    }

    /* Catppuccin Theme Overrides */
    html.theme--catppuccin-latte {
        --heading-color: #4c4f69;
        --primary-bg: #eff1f5;
        --icon-color: #4c4f69;
        --shadow-color: rgba(0, 0, 0, 0.1);
        --dropdown-hover-bg: #e6e9ef;
    }
    html.theme--catppuccin-frappe {
        --heading-color: #c6d0f5;
        --primary-bg: #303446;
        --icon-color: #c6d0f5;
        --shadow-color: rgba(255, 255, 255, 0.1);
        --dropdown-hover-bg: #51576d;
    }
    html.theme--catppuccin-macchiato {
        --heading-color: #cad3f5;
        --primary-bg: #24273a;
        --icon-color: #cad3f5;
        --shadow-color: rgba(255, 255, 255, 0.1);
        --dropdown-hover-bg: #494d64;
    }
    html.theme--catppuccin-mocha {
        --heading-color: #cad3f5;
        --primary-bg: #1e1e2e;
        --icon-color: #cad3f5;
        --shadow-color: rgba(255, 255, 255, 0.1);
        --dropdown-hover-bg: #45475a;
    }


    /* Main Navigation Bar */
    .ext-navigation {
        font-family: var(--font-family);
        position: fixed;
        height: var(--navbar-height);
        top: 0;
        width: 100%;
        background-color: var(--primary-bg);
        z-index: 1000;
        box-shadow: 0 2px 4px var(--shadow-color);
        display: flex;
        align-items: center;
        padding: 0 1.0625rem;
        transition: transform 0.3s, background-color 0.3s;
    }

    nav.ext-navigation .ext-navbar-logo {
        margin-left: var(--logo-margin-left);
        height: auto;
        max-height: var(--logo-height);
        width: auto;
        padding-top: var(--logo-padding-top);
    }
    
    /* Theme-aware logo text color */
    .ext-navbar-logo .logo-text {
        fill: var(--heading-color);
    }
    
    .ext-navbar-title {
        color: var(--heading-color) !important;
        font-size: var(--turing-title-font-size) !important;
        margin-left: var(--title-margin-left);
        text-decoration: none;
        transition: color 0.2s ease;
    }
    
    .ext-navbar-title:hover {
        color: var(--hover-color) !important;
    }

    .ext-nav-links {
        display: flex;
        align-items: center;
        list-style-type: none;
        margin: 0;
        padding: 0;
        flex-grow: 1;
        margin-left: var(--title-nav-spacing);
    }

    .ext-nav-links li:first-child {
        margin-left: 0 !important;
    }

    .ext-nav-links li {
        margin-left: var(--nav-item-margin-left) !important;
    }

    .ext-nav-link {
        color: var(--heading-color) !important;
        text-decoration: none;
        font-size: var(--nav-link-font-size) !important;
        transition: color 0.2s ease;
        cursor: pointer;
    }

    .ext-nav-link:hover,
    .ext-navbar-item-single a:hover,
    .ext-navbar-icons a:hover {
        color: var(--hover-color) !important;
    }

    .ext-navbar-item-single a {
        color: var(--heading-color) !important;
    }
    
    .ext-navbar-icons {
        display: flex;
        align-items: center;
    }

    .ext-navbar-icons a {
        color: var(--icon-color) !important;
        font-size: var(--icon-font-size) !important;
        transition: color 0.2s ease;
        margin-left: var(--icon-margin-left);
    }

    .ext-menu-toggle {
        display: none;
        font-size: 1.5rem;
        color: var(--heading-color);
        cursor: pointer;
    }

    .ext-dropdown {
        display: none;
        grid-template-columns: 1fr 1fr 1fr 1fr;
        padding: var(--dropdown-padding);
        position: absolute;
        top: var(--navbar-height);
        width: 100%;
        left: 0;
        background-color: var(--primary-bg);
        line-height: 1.875rem;
        opacity: 0;
        transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out, background-color 0.3s;
        transform: translateY(-0.625rem);
        box-shadow: 0 4px 6px var(--shadow-color);
    }

    #library-handler::after {
        content: "▼";
        font-size: var(--dropdown-arrow-font-size);
        margin-left: 0.3125rem;
        transition: transform 0.3s ease-in-out;
    }

    #library-handler.open::after {
        content: "▲";
    }

    .ext-dropdown.show {
        display: grid;
        opacity: 1;
        transform: translateY(0);
    }

    .ext-dropdown ul {
        width: var(--dropdown-item-width);
        margin-bottom: 1.25rem;
    }

    .ext-dropdown ul li {
        text-align: left;
        display: flex;
        align-items: center;
    }

    .ext-dropdown ul a li {
        color: var(--item-color);
        width: var(--dropdown-subitem-width);
        border-radius: 3px;
        padding: var(--dropdown-subitem-padding);
        transition: background-color 0.2s ease;
    }

    .ext-dropdown ul a li:hover {
        background-color: var(--dropdown-hover-bg);
    }

    .ext-dropdown-item-heading {
        color: var(--heading-color);
        text-align: center;
    }

    .deprecated-badge {
        background-color: var(--deprecated-bg);
        color: var(--deprecated-text);
        font-size: var(--badge-font-size);
        padding: .1rem;
        border-radius: 3px;
        margin-left: 0.5rem;
        line-height: 1;
    }

    @media (max-width: 966px) {
        .ext-dropdown {
            grid-template-columns: 1fr 1fr 1fr;
        }
    }

    @media (max-width: 768px) {
        .ext-nav-links {
            display: none;
            flex-direction: column;
            align-items: center;
            width: 100%;
            background-color: var(--primary-bg);
            position: absolute;
            top: var(--navbar-height);
            left: 0;
            padding: 0.625rem 0;
            height: auto;
            overflow-y: auto;
            box-shadow: 0 4px 6px var(--shadow-color);
            margin-left: 0;
        }

        .ext-nav-links.show {
            display: flex;
        }

        .ext-nav-links li {
            margin: 0.625rem 0 !important;
            text-align: center;
        }
        
        .ext-menu-toggle {
            display: block;
            margin-left: auto;
        }

        .ext-navigation.hide {
            transform: translateY(calc(-1 * var(--navbar-height)));
        }

        .ext-dropdown {
            position: static;
            display: block;
            opacity: 1;
            transform: none;
            box-shadow: none;
            grid-template-columns: 1fr;
            padding: 0.625rem;
            text-align: center;
        }

        .ext-dropdown ul {
            width: auto;
            display: inline-block;
            margin: 0 auto 0.3125rem;
            text-align: left;
        }
    }
</style>
<nav class="ext-navigation">
    <a href="https://turinglang.org/">
        <svg width="4333" height="1145" viewBox="0 0 4333 1145" fill="none" xmlns="http://www.w3.org/2000/svg" class="ext-navbar-logo">
            <path class="logo-text" d="M0.44603 193.181V66.9868H663.471V193.181H406.62V898H257.297V193.181H0.44603ZM1097.24 635.874V274.74H1244.13V898H1101.7V787.225H1095.21C1081.14 822.121 1058.01 850.66 1025.82 872.842C993.902 895.024 954.542 906.115 907.744 906.115C866.896 906.115 830.783 897.053 799.403 878.929C768.295 860.534 743.948 833.889 726.365 798.993C708.782 763.826 699.99 721.356 699.99 671.581V274.74H846.878V648.858C846.878 688.353 857.699 719.733 879.34 742.997C900.981 766.261 929.385 777.893 964.551 777.893C986.192 777.893 1007.16 772.618 1027.45 762.068C1047.73 751.518 1064.37 735.828 1077.35 714.999C1090.61 693.899 1097.24 667.524 1097.24 635.874ZM1395.17 898V274.74H1537.6V378.617H1544.09C1555.45 342.639 1574.93 314.911 1602.52 295.434C1630.38 275.687 1662.17 265.813 1697.88 265.813C1705.99 265.813 1715.05 266.219 1725.06 267.031C1735.34 267.572 1743.86 268.518 1750.63 269.871V404.992C1744.4 402.828 1734.53 400.934 1721 399.311C1707.75 397.417 1694.9 396.471 1682.46 396.471C1655.68 396.471 1631.6 402.287 1610.23 413.919C1589.13 425.28 1572.49 441.105 1560.32 461.393C1548.15 481.682 1542.06 505.081 1542.06 531.591V898H1395.17ZM1848.21 898V274.74H1995.1V898H1848.21ZM1922.06 186.283C1898.8 186.283 1878.78 178.573 1862.01 163.154C1845.24 147.464 1836.85 128.664 1836.85 106.752C1836.85 84.5701 1845.24 65.7695 1862.01 50.3503C1878.78 34.6606 1898.8 26.8158 1922.06 26.8158C1945.6 26.8158 1965.61 34.6606 1982.12 50.3503C1998.89 65.7695 2007.27 84.5701 2007.27 106.752C2007.27 128.664 1998.89 147.464 1982.12 163.154C1965.61 178.573 1945.6 186.283 1922.06 186.283ZM2293.04 532.809V898H2146.15V274.74H2286.54V380.646H2293.85C2308.18 345.75 2331.04 318.022 2362.42 297.463C2394.07 276.904 2433.16 266.625 2479.69 266.625C2522.7 266.625 2560.17 275.822 2592.09 294.217C2624.28 312.612 2649.17 339.257 2666.75 374.153C2684.6 409.049 2693.39 451.385 2693.12 501.159V898H2546.24V523.882C2546.24 482.223 2535.41 449.626 2513.77 426.092C2492.4 402.557 2462.78 390.79 2424.91 390.79C2399.21 390.79 2376.35 396.471 2356.34 407.832C2336.59 418.923 2321.03 435.019 2309.67 456.119C2298.58 477.218 2293.04 502.782 2293.04 532.809ZM3113.5 1144.71C3060.75 1144.71 3015.44 1137.54 2977.57 1123.2C2939.7 1109.13 2909.26 1090.2 2886.27 1066.39C2863.28 1042.59 2847.32 1016.21 2838.39 987.269L2970.67 955.213C2976.62 967.386 2985.28 979.424 2996.64 991.327C3008 1003.5 3023.28 1013.51 3042.49 1021.35C3061.97 1029.47 3086.45 1033.53 3115.93 1033.53C3157.59 1033.53 3192.08 1023.38 3219.4 1003.09C3246.73 983.076 3260.39 950.074 3260.39 904.087V786.008H3253.08C3245.51 801.157 3234.42 816.711 3219.81 832.671C3205.47 848.632 3186.4 862.022 3162.6 872.842C3139.06 883.663 3109.44 889.073 3073.73 889.073C3025.85 889.073 2982.44 877.847 2943.48 855.394C2904.8 832.671 2873.96 798.857 2850.97 753.952C2828.24 708.777 2816.88 652.24 2816.88 584.341C2816.88 515.902 2828.24 458.147 2850.97 411.078C2873.96 363.739 2904.93 327.896 2943.89 303.55C2982.84 278.933 3026.26 266.625 3074.14 266.625C3110.66 266.625 3140.69 272.847 3164.22 285.29C3188.03 297.463 3206.96 312.206 3221.03 329.519C3235.09 346.561 3245.78 362.657 3253.08 377.805H3261.2V274.74H3406.06V908.144C3406.06 961.435 3393.34 1005.53 3367.92 1040.42C3342.49 1075.32 3307.73 1101.43 3263.63 1118.74C3219.54 1136.05 3169.5 1144.71 3113.5 1144.71ZM3114.72 773.835C3145.83 773.835 3172.34 766.261 3194.25 751.112C3216.16 735.963 3232.79 714.187 3244.16 685.783C3255.52 657.379 3261.2 623.295 3261.2 583.53C3261.2 544.305 3255.52 509.95 3244.16 480.465C3233.07 450.979 3216.56 428.12 3194.65 411.89C3173.01 395.389 3146.37 387.138 3114.72 387.138C3081.98 387.138 3054.66 395.659 3032.75 412.701C3010.84 429.744 2994.34 453.143 2983.25 482.899C2972.16 512.385 2966.61 545.929 2966.61 583.53C2966.61 621.672 2972.16 655.08 2983.25 683.754C2994.61 712.158 3011.25 734.34 3033.16 750.3C3055.34 765.99 3082.53 773.835 3114.72 773.835ZM3647.08 906.927C3622.47 906.927 3601.37 898.271 3583.78 880.958C3566.2 863.645 3557.54 842.545 3557.82 817.658C3557.54 793.312 3566.2 772.482 3583.78 755.17C3601.37 737.857 3622.47 729.2 3647.08 729.2C3670.89 729.2 3691.58 737.857 3709.17 755.17C3727.02 772.482 3736.08 793.312 3736.35 817.658C3736.08 834.159 3731.75 849.173 3723.37 862.698C3715.25 876.224 3704.43 887.044 3690.91 895.16C3677.65 903.004 3663.04 906.927 3647.08 906.927ZM3888.01 274.74H4034.9V933.708C4034.9 978.613 4026.38 1015.67 4009.33 1044.89C3992.29 1074.1 3967.67 1095.88 3935.48 1110.22C3903.29 1124.55 3864.2 1131.72 3818.22 1131.72C3812.81 1131.72 3807.8 1131.59 3803.2 1131.32C3798.6 1131.32 3793.6 1131.18 3788.19 1130.91V1011.21C3792.25 1011.48 3795.9 1011.62 3799.15 1011.62C3802.39 1011.89 3805.77 1012.02 3809.29 1012.02C3837.42 1012.02 3857.58 1005.12 3869.75 991.327C3881.92 977.801 3888.01 957.918 3888.01 931.679V274.74ZM3961.05 186.283C3937.51 186.283 3917.36 178.573 3900.59 163.154C3884.09 147.464 3875.84 128.664 3875.84 106.752C3875.84 84.5701 3884.09 65.7695 3900.59 50.3503C3917.36 34.6606 3937.51 26.8158 3961.05 26.8158C3984.31 26.8158 4004.19 34.6606 4020.7 50.3503C4037.47 65.7695 4045.85 84.5701 4045.85 106.752C4045.85 128.664 4037.47 147.464 4020.7 163.154C4004.19 178.573 3984.31 186.283 3961.05 186.283ZM4332.83 66.9868V898H4185.94V66.9868H4332.83Z" fill="currentColor"/>
            <path d="M4076 108.5C4076 168.424 4027.42 217 3967.5 217C3907.58 217 3859 168.424 3859 108.5C3859 48.5762 3907.58 0 3967.5 0C4027.42 0 4076 48.5762 4076 108.5Z" fill="#389725"/>
            <path d="M3755 814.5C3755 874.424 3706.42 923 3646.5 923C3586.58 923 3538 874.424 3538 814.5C3538 754.576 3586.58 706 3646.5 706C3706.42 706 3755 754.576 3755 814.5Z" fill="#9457B1"/>
            <path d="M2030 108.5C2030 168.424 1981.42 217 1921.5 217C1861.58 217 1813 168.424 1813 108.5C1813 48.5762 1861.58 0 1921.5 0C1981.42 0 2030 48.5762 2030 108.5Z" fill="#CA3B33"/>
        </svg>
    </a>
    <!-- <a class="ext-navbar-title" href="https://turinglang.org/">Turing.jl</a> -->
    
    <ul class="ext-nav-links">
        <li><a class="ext-nav-link" href="https://turinglang.org/docs/getting-started/">Get Started</a></li>
        <li><a class="ext-nav-link" href="https://turinglang.org/docs/tutorials/">Tutorials</a></li>
        <li><a class="ext-nav-link" href="https://turinglang.org/docs/faq/">FAQ</a></li>
        <li>
            <p class="ext-nav-link" id="library-handler">Libraries</p>
            <div class="ext-dropdown" id="ext-dropdown-items">
                <ul>
                    <li class="ext-dropdown-item-heading">Modelling Languages</li>
                    <a href="https://turinglang.org/DynamicPPL.jl/"><li>DynamicPPL</li></a>
                    <a href="https://turinglang.org/JuliaBUGS.jl/"><li>JuliaBUGS</li></a>
                    <a href="https://turinglang.org/TuringGLM.jl/"><li>TuringGLM</li></a>
                </ul>
                <ul>
                    <li class="ext-dropdown-item-heading">MCMC</li>
                    <a href="https://turinglang.org/AdvancedHMC.jl/"><li>AdvancedHMC</li></a>
                    <a href="https://turinglang.org/AbstractMCMC.jl/"><li>AbstractMCMC</li></a>
                    <a href="https://github.com/theogf/ThermodynamicIntegration.jl"><li>ThermodynamicIntegration</li></a>
                    <a href="https://turinglang.org/AdvancedPS.jl/"><li>AdvancedPS</li></a>
                    <a href="https://turinglang.org/SliceSampling.jl/"><li>SliceSampling</li></a>
                    <a href="https://turinglang.org/EllipticalSliceSampling.jl/"><li>EllipticalSliceSampling</li></a>
                </ul>
                <ul>
                    <li class="ext-dropdown-item-heading">Diagnostics</li>
                    <a href="https://turinglang.org/MCMCChains.jl/"><li>MCMCChains</li></a>
                    <a href="https://turinglang.org/MCMCDiagnosticTools.jl/"><li>MCMCDiagnosticTools</li></a>
                    <a href="https://chalk-lab.github.io/ParetoSmooth.jl/"><li>ParetoSmooth</li></a>
                </ul>
                <ul>
                    <li class="ext-dropdown-item-heading">Gaussian Processes</li>
                    <a href="https://juliagaussianprocesses.github.io/AbstractGPs.jl/"><li>AbstractGPs</li></a>
                    <a href="https://juliagaussianprocesses.github.io/KernelFunctions.jl/"><li>KernelFunctions</li></a>
                    <a href="https://juliagaussianprocesses.github.io/ApproximateGPs.jl/"><li>ApproximateGPs</li></a>
                </ul>
                <ul><li class="ext-dropdown-item-heading ext-navbar-item-single"><a href="https://turinglang.org/Bijectors.jl/">Bijectors</a></li></ul>
                <ul><li class="ext-dropdown-item-heading ext-navbar-item-single"><a href="https://turinglang.org/TuringCallbacks.jl/">TuringCallbacks</a></li></ul>
                <ul><li class="ext-dropdown-item-heading ext-navbar-item-single"><a href="https://turinglang.org/Deprecated/TuringBenchmarking/">TuringBenchmarking</a><span class="deprecated-badge">Deprecated</span></li></ul>
            </div>
        </li>
        <li><a class="ext-nav-link" href="https://turinglang.org/news/">News</a></li>
        <li><a class="ext-nav-link" href="https://turinglang.org/team/">Team</a></li>
    </ul>

    <div class="ext-navbar-icons">
        <a href="https://x.com/TuringLang" aria-label="Turing on X"><i class="fa-brands fa-x-twitter"></i></a>
        <a href="https://discourse.julialang.org/c/domain/probprog/48" aria-label="Turing on Discourse"><i class="fa-brands fa-discourse"></i></a>
        <a href="https://julialang.slack.com/archives/CCYDC34A0" aria-label="Turing on Slack"><i class="fa-brands fa-slack"></i></a>
        <a href="https://github.com/TuringLang/" aria-label="Turing.jl on GitHub"><i class="fa-brands fa-github"></i></a>
    </div>

    <span class="ext-menu-toggle"><i class="fa-solid fa-bars"></i></span>
</nav>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const menuToggle = document.querySelector(".ext-menu-toggle");
        const navLinks = document.querySelector(".ext-nav-links");
        const nav = document.querySelector(".ext-navigation");
        const libraryHandler = document.getElementById("library-handler");
        const dropdownContainer = document.getElementById("ext-dropdown-items");
        let lastScrollY = window.scrollY;

        function closeDropdown() {
            if (dropdownContainer.classList.contains("show")) {
                libraryHandler.classList.remove("open");
                dropdownContainer.classList.remove("show");
                setTimeout(() => {
                    if (!dropdownContainer.classList.contains("show")) {
                        dropdownContainer.style.display = "none";
                    }
                }, 300);
            }
        }

        function openDropdown() {
            dropdownContainer.style.display = "grid";
            libraryHandler.classList.add("open");
            setTimeout(() => {
                dropdownContainer.classList.add("show");
            }, 10);
        }

        function setAppropriateHeight() {
            if (window.innerWidth <= 768) {
                const viewportHeight = window.innerHeight;
                const navHeight = nav.offsetHeight;
                navLinks.style.maxHeight = `${viewportHeight - navHeight}px`;
                navLinks.style.overflowY = "auto";
            } else {
                navLinks.style.maxHeight = "";
                navLinks.style.overflowY = "";
            }
        }

        menuToggle.addEventListener("click", (event) => {
            event.stopPropagation();
            navLinks.classList.toggle("show");
            if (navLinks.classList.contains("show")) {
                setAppropriateHeight();
                closeDropdown();
                dropdownContainer.style.display = "none";
            }
        });

        libraryHandler.addEventListener("click", (event) => {
            event.stopPropagation();
            event.preventDefault();
            if (dropdownContainer.classList.contains("show")) {
                closeDropdown();
            } else {
                openDropdown();
            }
            setAppropriateHeight();
        });

        // Close all menus if a click is registered outside the navigation bar.
        document.addEventListener("click", (event) => {
            if (!nav.contains(event.target)) {
                navLinks.classList.remove("show");
                closeDropdown();
            }
        });

        // Hide navigation bar on scroll down in mobile view.
        window.addEventListener("scroll", () => {
            if (window.innerWidth <= 768) {
                if (window.scrollY > lastScrollY && window.scrollY > nav.offsetHeight){
                    nav.classList.add("hide");
                } else {
                    nav.classList.remove("hide");
                }
                lastScrollY = window.scrollY;
            }
        });

        window.addEventListener("resize", setAppropriateHeight);
    });
</script>
<!-- NAVBAR END -->



<div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="DynamicPPL logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DynamicPPL</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../api/">API</a></li><li><span class="tocitem">Internals</span><ul><li class="is-active"><a class="tocitem" href>Design of <code>VarInfo</code></a><ul class="internal"><li><a class="tocitem" href="#Type-stability"><span>Type-stability</span></a></li><li><a class="tocitem" href="#Efficient-storage-and-iteration"><span>Efficient storage and iteration</span></a></li><li><a class="tocitem" href="#Other-methods"><span>Other methods</span></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Internals</a></li><li class="is-active"><a href>Design of <code>VarInfo</code></a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Design of <code>VarInfo</code></a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/TuringLang/DynamicPPL.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/TuringLang/DynamicPPL.jl/blob/main/docs/src/internals/varinfo.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Design-of-VarInfo"><a class="docs-heading-anchor" href="#Design-of-VarInfo">Design of <code>VarInfo</code></a><a id="Design-of-VarInfo-1"></a><a class="docs-heading-anchor-permalink" href="#Design-of-VarInfo" title="Permalink"></a></h1><p><a href="../../api/#VarInfo"><code>VarInfo</code></a> is a fairly simple structure.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DynamicPPL.VarInfo-internals-varinfo" href="#DynamicPPL.VarInfo-internals-varinfo"><code>DynamicPPL.VarInfo</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct VarInfo{Tmeta,Accs&lt;:AccumulatorTuple} &lt;: AbstractVarInfo
    metadata::Tmeta
    accs::Accs
end</code></pre><p>A light wrapper over some kind of metadata.</p><p>The type of the metadata can be one of a number of options. It may either be a <code>Metadata</code> or a <code>VarNamedVector</code>, <em>or</em>, it may be a <code>NamedTuple</code> which maps symbols to <code>Metadata</code> or <code>VarNamedVector</code> instances. Here, a <em>symbol</em> refers to a Julia variable and may consist of one or more <code>VarName</code>s which appear on the left-hand side of tilde statements. For example, <code>x[1]</code> and <code>x[2]</code> both have the same symbol <code>x</code>.</p><p>Several type aliases are provided for these forms of VarInfos:</p><ul><li><code>VarInfo{&lt;:Metadata}</code> is <code>UntypedVarInfo</code></li><li><code>VarInfo{&lt;:VarNamedVector}</code> is <code>UntypedVectorVarInfo</code></li><li><code>VarInfo{&lt;:NamedTuple}</code> is <code>NTVarInfo</code></li></ul><p>The NamedTuple form, i.e. <code>NTVarInfo</code>, is useful for maintaining type stability of model evaluation. However, the element type of NamedTuples are not contained in its type itself: thus, there is no way to use the type system to determine whether the elements of the NamedTuple are <code>Metadata</code> or <code>VarNamedVector</code>.</p><p>Note that for NTVarInfo, it is the user&#39;s responsibility to ensure that each symbol is visited at least once during model evaluation, regardless of any stochastic branching.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/DynamicPPL.jl/blob/0d947a8eeeffa1ee0b6af5f85f60c391b193f5d1/src/varinfo.jl#L78-L106">source</a></section></article><p>It contains</p><ul><li>a <code>logp</code> field for accumulation of the log-density evaluation, and</li><li>a <code>metadata</code> field for storing information about the realizations of the different variables.</li></ul><p>Representing <code>logp</code> is fairly straight-forward: we&#39;ll just use a <code>Real</code> or an array of <code>Real</code>, depending on the context.</p><p><strong>Representing <code>metadata</code> is a bit trickier</strong>. This is supposed to contain all the necessary information for each <code>VarName</code> to enable the different executions of the model + extraction of different properties of interest after execution, e.g. the realization / value corresponding to a variable <code>@varname(x)</code>.</p><div class="admonition is-info" id="Note-f27b40b961c1f8"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-f27b40b961c1f8" title="Permalink"></a></header><div class="admonition-body"><p>We want to work with <code>VarName</code> rather than something like <code>Symbol</code> or <code>String</code> as <code>VarName</code> contains additional structural information, e.g. a <code>Symbol(&quot;x[1]&quot;)</code> can be a result of either <code>var&quot;x[1]&quot; ~ Normal()</code> or <code>x[1] ~ Normal()</code>; these scenarios are disambiguated by <code>VarName</code>.</p></div></div><p>To ensure that <code>VarInfo</code> is simple and intuitive to work with, we want <code>VarInfo</code>, and hence the underlying <code>metadata</code>, to replicate the following functionality of <code>Dict</code>:</p><ul><li><code>keys(::Dict)</code>: return all the <code>VarName</code>s present in <code>metadata</code>.</li><li><code>haskey(::Dict)</code>: check if a particular <code>VarName</code> is present in <code>metadata</code>.</li><li><code>getindex(::Dict, ::VarName)</code>: return the realization corresponding to a particular <code>VarName</code>.</li><li><code>setindex!(::Dict, val, ::VarName)</code>: set the realization corresponding to a particular <code>VarName</code>.</li><li><code>push!(::Dict, ::Pair)</code>: add a new key-value pair to the container.</li><li><code>delete!(::Dict, ::VarName)</code>: delete the realization corresponding to a particular <code>VarName</code>.</li><li><code>empty!(::Dict)</code>: delete all realizations in <code>metadata</code>.</li><li><code>merge(::Dict, ::Dict)</code>: merge two <code>metadata</code> structures according to similar rules as <code>Dict</code>.</li></ul><p><em>But</em> for general-purpose samplers, we often want to work with a simple flattened structure, typically a <code>Vector{&lt;:Real}</code>. One can access a vectorised version of a variable&#39;s value with the following vector-like functions:</p><ul><li><code>getindex_internal(::VarInfo, ::VarName)</code>: get the flattened value of a single variable.</li><li><code>getindex_internal(::VarInfo, ::Colon)</code>: get the flattened values of all variables.</li><li><code>getindex_internal(::VarInfo, i::Int)</code>: get <code>i</code>th value of the flattened vector of all values</li><li><code>setindex_internal!(::VarInfo, ::AbstractVector, ::VarName)</code>: set the flattened value of a variable.</li><li><code>setindex_internal!(::VarInfo, val, i::Int)</code>: set the <code>i</code>th value of the flattened vector of all values</li><li><code>length_internal(::VarInfo)</code>: return the length of the flat representation of <code>metadata</code>.</li></ul><p>The functions have <code>_internal</code> in their name because internally <code>VarInfo</code> always stores values as vectorised.</p><p>Moreover, a link transformation can be applied to a <code>VarInfo</code> with <code>link!!</code> (and reversed with <code>invlink!!</code>), which applies a reversible transformation to the internal storage format of a variable that makes the range of the random variable cover all of Euclidean space. <code>getindex_internal</code> and <code>setindex_internal!</code> give direct access to the vectorised value after such a transformation, which is what samplers often need to be able sample in unconstrained space. One can also manually set a transformation by giving <code>setindex_internal!</code> a fourth, optional argument, that is a function that maps internally stored value to the actual value of the variable.</p><p>Finally, we want want the underlying representation used in <code>metadata</code> to have a few performance-related properties:</p><ol><li>Type-stable when possible, but functional when not.</li><li>Efficient storage and iteration when possible, but functional when not.</li></ol><p>The &quot;but functional when not&quot; is important as we want to support arbitrary models, which means that we can&#39;t always have these performance properties.</p><p>In the following sections, we&#39;ll outline how we achieve this in <a href="../../api/#VarInfo"><code>VarInfo</code></a>.</p><h2 id="Type-stability"><a class="docs-heading-anchor" href="#Type-stability">Type-stability</a><a id="Type-stability-1"></a><a class="docs-heading-anchor-permalink" href="#Type-stability" title="Permalink"></a></h2><p>Ensuring type-stability is somewhat non-trivial to address since we want this to be the case even when models mix continuous (typically <code>Float64</code>) and discrete (typically <code>Int</code>) variables.</p><p>Suppose we have an implementation of <code>metadata</code> which implements the functionality outlined in the previous section. The way we approach this in <code>VarInfo</code> is to use a <code>NamedTuple</code> with a separate <code>metadata</code> <em>for each distinct <code>Symbol</code> used</em>. For example, if we have a model of the form</p><pre><code class="language-julia hljs">using DynamicPPL, Distributions, FillArrays

@model function demo()
    x ~ product_distribution(Fill(Bernoulli(0.5), 2))
    y ~ Normal(0, 1)
    return nothing
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">demo (generic function with 2 methods)</code></pre><p>then we construct a type-stable representation by using a <code>NamedTuple{(:x, :y), Tuple{Vx, Vy}}</code> where</p><ul><li><code>Vx</code> is a container with <code>eltype</code> <code>Bool</code>, and</li><li><code>Vy</code> is a container with <code>eltype</code> <code>Float64</code>.</li></ul><p>Since <code>VarName</code> contains the <code>Symbol</code> used in its type, something like <code>getindex(varinfo, @varname(x))</code> can be resolved to <code>getindex(varinfo.metadata.x, @varname(x))</code> at compile-time.</p><p>For example, with the model above we have</p><pre><code class="language-julia hljs"># Type-unstable `VarInfo`
varinfo_untyped = DynamicPPL.untyped_varinfo(demo())
typeof(varinfo_untyped.metadata)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">DynamicPPL.Metadata{Dict{VarName, Int64}, Vector{Distribution}, Vector{VarName}, Vector{Real}}</code></pre><pre><code class="language-julia hljs"># Type-stable `VarInfo`
varinfo_typed = DynamicPPL.typed_varinfo(demo())
typeof(varinfo_typed.metadata)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">@NamedTuple{x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Product{Discrete, Bernoulli{Float64}, FillArrays.Fill{Bernoulli{Float64}, 1, Tuple{Base.OneTo{Int64}}}}}, Vector{VarName{:x, typeof(identity)}}, BitVector}, y::DynamicPPL.Metadata{Dict{VarName{:y, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:y, typeof(identity)}}, Vector{Float64}}}</code></pre><p>They both work as expected but one results in concrete typing and the other does not:</p><pre><code class="language-julia hljs">varinfo_untyped[@varname(x)], varinfo_untyped[@varname(y)]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(Real[false, false], -2.2702371886488093)</code></pre><pre><code class="language-julia hljs">varinfo_typed[@varname(x)], varinfo_typed[@varname(y)]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(Bool[1, 1], -1.7666742497380907)</code></pre><p>Notice that the untyped <code>VarInfo</code> uses <code>Vector{Real}</code> to store the boolean entries while the typed uses <code>Vector{Bool}</code>. This is because the untyped version needs the underlying container to be able to handle both the <code>Bool</code> for <code>x</code> and the <code>Float64</code> for <code>y</code>, while the typed version can use a <code>Vector{Bool}</code> for <code>x</code> and a <code>Vector{Float64}</code> for <code>y</code> due to its usage of <code>NamedTuple</code>.</p><div class="admonition is-warning" id="Warning-f7562dbff40d1dcf"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-f7562dbff40d1dcf" title="Permalink"></a></header><div class="admonition-body"><p>Of course, this <code>NamedTuple</code> approach is <em>not</em> necessarily going to help us in scenarios where the <code>Symbol</code> does not correspond to a unique type, e.g.</p><pre><code class="language-julia hljs">x[1] ~ Bernoulli(0.5)
x[2] ~ Normal(0, 1)</code></pre><p>In this case we&#39;ll end up with a <code>NamedTuple((:x,), Tuple{Vx})</code> where <code>Vx</code> is a container with <code>eltype</code> <code>Union{Bool, Float64}</code> or something worse. This is <em>not</em> type-stable but will still be functional.</p><p>In practice, we rarely observe such mixing of types, therefore in DynamicPPL, and more widely in Turing.jl, we use a <code>NamedTuple</code> approach for type-stability with great success.</p></div></div><div class="admonition is-warning" id="Warning-97f4f80f17901f32"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-97f4f80f17901f32" title="Permalink"></a></header><div class="admonition-body"><p>Another downside with such a <code>NamedTuple</code> approach is that if we have a model with lots of tilde-statements, e.g. <code>a ~ Normal()</code>, <code>b ~ Normal()</code>, ..., <code>z ~ Normal()</code> will result in a <code>NamedTuple</code> with 27 entries, potentially leading to long compilation times.</p><p>For these scenarios it can be useful to fall back to &quot;untyped&quot; representations.</p></div></div><p>Hence we obtain a &quot;type-stable when possible&quot;-representation by wrapping it in a <code>NamedTuple</code> and partially resolving the <code>getindex</code>, <code>setindex!</code>, etc. methods at compile-time. When type-stability is <em>not</em> desired, we can simply use a single <code>metadata</code> for all <code>VarName</code>s instead of a <code>NamedTuple</code> wrapping a collection of <code>metadata</code>s.</p><h2 id="Efficient-storage-and-iteration"><a class="docs-heading-anchor" href="#Efficient-storage-and-iteration">Efficient storage and iteration</a><a id="Efficient-storage-and-iteration-1"></a><a class="docs-heading-anchor-permalink" href="#Efficient-storage-and-iteration" title="Permalink"></a></h2><p>Efficient storage and iteration we achieve through implementation of the <code>metadata</code>. In particular, we do so with <a href="#DynamicPPL.VarNamedVector"><code>DynamicPPL.VarNamedVector</code></a>:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DynamicPPL.VarNamedVector" href="#DynamicPPL.VarNamedVector"><code>DynamicPPL.VarNamedVector</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">VarNamedVector</code></pre><p>A container that stores values in a vectorised form, but indexable by variable names.</p><p>A <code>VarNamedVector</code> can be thought of as an ordered mapping from <code>VarName</code>s to pairs of <code>(internal_value, transform)</code>. Here <code>internal_value</code> is a vectorised value for the variable and <code>transform</code> is a function such that <code>transform(internal_value)</code> is the &quot;original&quot; value of the variable, the one that the user sees. For instance, if the variable has a matrix value, <code>internal_value</code> could bea flattened <code>Vector</code> of its elements, and <code>transform</code> would be a <code>reshape</code> call.</p><p><code>transform</code> may implement simply vectorisation, but it may do more. Most importantly, it may implement linking, where the internal storage of a random variable is in a form where all values in Euclidean space are valid. This is useful for sampling, because the sampler can make changes to <code>internal_value</code> without worrying about constraints on the space of the random variable.</p><p>The way to access this storage format directly is through the functions <code>getindex_internal</code> and <code>setindex_internal</code>. The <code>transform</code> argument for <code>setindex_internal</code> is optional, by default it is either the identity, or the existing transform if a value already exists for this <code>VarName</code>.</p><p><code>VarNamedVector</code> also provides a <code>Dict</code>-like interface that hides away the internal vectorisation. This can be accessed with <code>getindex</code> and <code>setindex!</code>. <code>setindex!</code> only takes the value, the transform is automatically set to be a simple vectorisation. The only notable deviation from the behavior of a <code>Dict</code> is that <code>setindex!</code> will throw an error if one tries to set a new value for a variable that lives in a different &quot;space&quot; than the old one (e.g. is of a different type or size). This is because <code>setindex!</code> does not change the transform of a variable, e.g. preserve linking, and thus the new value must be compatible with the old transform.</p><p>For now, a third value is in fact stored for each <code>VarName</code>: a boolean indicating whether the variable has been transformed to unconstrained Euclidean space or not. This is only in place temporarily due to the needs of our old Gibbs sampler.</p><p>Internally, <code>VarNamedVector</code> stores the values of all variables in a single contiguous vector. This makes some operations more efficient, and means that one can access the entire contents of the internal storage quickly with <code>getindex_internal(vnv, :)</code>. The other fields of <code>VarNamedVector</code> are mostly used to keep track of which part of the internal storage belongs to which <code>VarName</code>.</p><p><strong>Fields</strong></p><ul><li><code>varname_to_index</code>: mapping from a <code>VarName</code> to its integer index in <code>varnames</code>, <code>ranges</code> and <code>transforms</code></li></ul><ul><li><code>varnames</code>: vector of <code>VarNames</code> for the variables, where <code>varnames[varname_to_index[vn]] == vn</code></li></ul><ul><li><code>ranges</code>: vector of index ranges in <code>vals</code> corresponding to <code>varnames</code>; each <code>VarName</code> <code>vn</code> has a single index or a set of contiguous indices, such that the values of <code>vn</code> can be found at <code>vals[ranges[varname_to_index[vn]]]</code></li></ul><ul><li><code>vals</code>: vector of values of all variables; the value(s) of <code>vn</code> is/are <code>vals[ranges[varname_to_index[vn]]]</code></li></ul><ul><li><code>transforms</code>: vector of transformations, so that <code>transforms[varname_to_index[vn]]</code> is a callable that transforms the value of <code>vn</code> back to its original space, undoing any linking and vectorisation</li></ul><ul><li><code>is_unconstrained</code>: vector of booleans indicating whether a variable has been explicitly transformed to unconstrained Euclidean space, i.e. whether its domain is all of <code>ℝ^ⁿ</code>. If <code>is_unconstrained[varname_to_index[vn]]</code> is true, it guarantees that the variable <code>vn</code> is not constrained. However, the converse does not hold: if <code>is_unconstrained</code> is false, the variable <code>vn</code> may still happen to be unconstrained, e.g. if its original distribution is itself unconstrained (like a normal distribution).</li></ul><ul><li><code>num_inactive</code>: mapping from a variable index to the number of inactive entries for that variable. Inactive entries are elements in <code>vals</code> that are not part of the value of any variable. They arise when a variable is set to a new value with a different dimension, in-place. Inactive entries always come after the last active entry for the given variable. See the extended help with <code>??VarNamedVector</code> for more details.</li></ul><p><strong>Extended help</strong></p><p>The values for different variables are internally all stored in a single vector. For instance,</p><pre><code class="language-julia-repl hljs">julia&gt; using DynamicPPL: ReshapeTransform, VarNamedVector, @varname, setindex!, update!, getindex_internal

julia&gt; vnv = VarNamedVector();

julia&gt; setindex!(vnv, [0.0, 0.0, 0.0, 0.0], @varname(x));

julia&gt; setindex!(vnv, reshape(1:6, (2,3)), @varname(y));

julia&gt; vnv.vals
10-element Vector{Real}:
 0.0
 0.0
 0.0
 0.0
 1
 2
 3
 4
 5
 6</code></pre><p>The <code>varnames</code>, <code>ranges</code>, and <code>varname_to_index</code> fields keep track of which value belongs to which variable. The <code>transforms</code> field stores the transformations that needed to transform the vectorised internal storage back to its original form:</p><pre><code class="language-julia-repl hljs">julia&gt; vnv.transforms[vnv.varname_to_index[@varname(y)]] == DynamicPPL.ReshapeTransform((6,), (2,3))
true</code></pre><p>If a variable is updated with a new value that is of a smaller dimension than the old value, rather than resizing <code>vnv.vals</code>, some elements in <code>vnv.vals</code> are marked as inactive.</p><pre><code class="language-julia-repl hljs">julia&gt; update!(vnv, [46.0, 48.0], @varname(x))

julia&gt; vnv.vals
10-element Vector{Real}:
 46.0
 48.0
  0.0
  0.0
  1
  2
  3
  4
  5
  6

julia&gt; println(vnv.num_inactive);
OrderedDict(1 =&gt; 2)</code></pre><p>This helps avoid unnecessary memory allocations for values that repeatedly change dimension. The user does not have to worry about the inactive entries as long as they use functions like <code>setindex!</code> and <code>getindex!</code> rather than directly accessing <code>vnv.vals</code>.</p><pre><code class="language-julia-repl hljs">julia&gt; vnv[@varname(x)]
2-element Vector{Real}:
 46.0
 48.0

julia&gt; getindex_internal(vnv, :)
8-element Vector{Real}:
 46.0
 48.0
  1
  2
  3
  4
  5
  6</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/DynamicPPL.jl/blob/0d947a8eeeffa1ee0b6af5f85f60c391b193f5d1/src/varnamedvector.jl#L1-L127">source</a></section></article><p>In a <a href="#DynamicPPL.VarNamedVector"><code>DynamicPPL.VarNamedVector{&lt;:VarName,T}</code></a>, we achieve the desiderata by storing the values for different <code>VarName</code>s contiguously in a <code>Vector{T}</code> and keeping track of which ranges correspond to which <code>VarName</code>s.</p><p>This does require a bit of book-keeping, in particular when it comes to insertions and deletions. Internally, this is handled by assigning each <code>VarName</code> a unique <code>Int</code> index in the <code>varname_to_index</code> field, which is then used to index into the following fields:</p><ul><li><code>varnames::Vector{&lt;:VarName}</code>: the <code>VarName</code>s in the order they appear in the <code>Vector{T}</code>.</li><li><code>ranges::Vector{UnitRange{Int}}</code>: the ranges of indices in the <code>Vector{T}</code> that correspond to each <code>VarName</code>.</li><li><code>transforms::Vector</code>: the transforms associated with each <code>VarName</code>.</li></ul><p>Mutating functions, e.g. <code>setindex_internal!(vnv::VarNamedVector, val, vn::VarName)</code>, are then treated according to the following rules:</p><ol><li><p>If <code>vn</code> is not already present: add it to the end of <code>vnv.varnames</code>, add the <code>val</code> to the underlying <code>vnv.vals</code>, etc.</p></li><li><p>If <code>vn</code> is already present in <code>vnv</code>:</p><ol><li>If <code>val</code> has the <em>same length</em> as the existing value for <code>vn</code>: replace existing value.</li><li>If <code>val</code> has a <em>smaller length</em> than the existing value for <code>vn</code>: replace existing value and mark the remaining indices as &quot;inactive&quot; by increasing the entry in <code>vnv.num_inactive</code> field.</li><li>If <code>val</code> has a <em>larger length</em> than the existing value for <code>vn</code>: expand the underlying <code>vnv.vals</code> to accommodate the new value, update all <code>VarName</code>s occuring after <code>vn</code>, and update the <code>vnv.ranges</code> to point to the new range for <code>vn</code>.</li></ol></li></ol><p>This means that <code>VarNamedVector</code> is allowed to grow as needed, while &quot;shrinking&quot; (i.e. insertion of smaller elements) is handled by simply marking the redundant indices as &quot;inactive&quot;. This turns out to be efficient for use-cases that we are generally interested in.</p><p>For example, we want to optimize code-paths which effectively boil down to inner-loop in the following example:</p><pre><code class="language-julia hljs"># Construct a `VarInfo` with types inferred from `model`.
varinfo = VarInfo(model)

# Repeatedly sample from `model`.
for _ in 1:num_samples
    rand!(rng, model, varinfo)

    # Do something with `varinfo`.
    # ...
end</code></pre><p>There are typically a few scenarios where we encounter changing representation sizes of a random variable <code>x</code>:</p><ol><li>We&#39;re working with a transformed version <code>x</code> which is represented in a lower-dimensional space, e.g. transforming a <code>x ~ LKJ(2, 1)</code> to unconstrained <code>y = f(x)</code> takes us from 2-by-2 <code>Matrix{Float64}</code> to a 1-length <code>Vector{Float64}</code>.</li><li><code>x</code> has a random size, e.g. in a mixture model with a prior on the number of components. Here the size of <code>x</code> can vary widly between every realization of the <code>Model</code>.</li></ol><p>In scenario (1), we&#39;re usually <em>shrinking</em> the representation of <code>x</code>, and so we end up not making any allocations for the underlying <code>Vector{T}</code> but instead just marking the redundant part as &quot;inactive&quot;.</p><p>In scenario (2), we  end up increasing the allocated memory for the randomly sized <code>x</code>, eventually leading to a vector that is large enough to hold realizations without needing to reallocate. But this can still lead to unnecessary memory usage, which might be undesirable. Hence one has to make a decision regarding the trade-off between memory usage and performance for the use-case at hand.</p><p>To help with this, we have the following functions:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DynamicPPL.has_inactive" href="#DynamicPPL.has_inactive"><code>DynamicPPL.has_inactive</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">has_inactive(vnv::VarNamedVector)</code></pre><p>Returns <code>true</code> if <code>vnv</code> has inactive entries.</p><p>See also: <a href="#DynamicPPL.num_inactive"><code>num_inactive</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/DynamicPPL.jl/blob/0d947a8eeeffa1ee0b6af5f85f60c391b193f5d1/src/varnamedvector.jl#L350-L356">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DynamicPPL.num_inactive" href="#DynamicPPL.num_inactive"><code>DynamicPPL.num_inactive</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">num_inactive(vnv::VarNamedVector)</code></pre><p>Return the number of inactive entries in <code>vnv</code>.</p><p>See also: <a href="#DynamicPPL.has_inactive"><code>has_inactive</code></a>, <a href="#DynamicPPL.num_allocated"><code>num_allocated</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/DynamicPPL.jl/blob/0d947a8eeeffa1ee0b6af5f85f60c391b193f5d1/src/varnamedvector.jl#L359-L365">source</a></section><section><div><pre><code class="language-julia hljs">num_inactive(vnv::VarNamedVector, vn::VarName)</code></pre><p>Returns the number of inactive entries for <code>vn</code> in <code>vnv</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/DynamicPPL.jl/blob/0d947a8eeeffa1ee0b6af5f85f60c391b193f5d1/src/varnamedvector.jl#L368-L372">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DynamicPPL.num_allocated" href="#DynamicPPL.num_allocated"><code>DynamicPPL.num_allocated</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">num_allocated(vnv::VarNamedVector)
num_allocated(vnv::VarNamedVector[, vn::VarName])
num_allocated(vnv::VarNamedVector[, idx::Int])</code></pre><p>Return the number of allocated entries in <code>vnv</code>, both active and inactive.</p><p>If either a <code>VarName</code> or an <code>Int</code> index is specified, only count entries allocated for that variable.</p><p>Allocated entries take up memory in <code>vnv.vals</code>, but, if inactive, may not currently hold any meaningful data. One can remove them with <a href="#DynamicPPL.contiguify!"><code>contiguify!</code></a>, but doing so may cause more memory allocations in the future if variables change dimension.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/DynamicPPL.jl/blob/0d947a8eeeffa1ee0b6af5f85f60c391b193f5d1/src/varnamedvector.jl#L376-L389">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DynamicPPL.is_contiguous" href="#DynamicPPL.is_contiguous"><code>DynamicPPL.is_contiguous</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">is_contiguous(vnv::VarNamedVector)</code></pre><p>Returns <code>true</code> if the underlying data of <code>vnv</code> is stored in a contiguous array.</p><p>This is equivalent to negating <a href="#DynamicPPL.has_inactive"><code>has_inactive(vnv)</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/DynamicPPL.jl/blob/0d947a8eeeffa1ee0b6af5f85f60c391b193f5d1/src/varnamedvector.jl#L1200-L1206">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DynamicPPL.contiguify!" href="#DynamicPPL.contiguify!"><code>DynamicPPL.contiguify!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">contiguify!(vnv::VarNamedVector)</code></pre><p>Re-contiguify the underlying vector and shrink if possible.</p><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; using DynamicPPL: VarNamedVector, @varname, contiguify!, update!, has_inactive

julia&gt; vnv = VarNamedVector(@varname(x) =&gt; [1.0, 2.0, 3.0], @varname(y) =&gt; [3.0]);

julia&gt; update!(vnv, [23.0, 24.0], @varname(x));

julia&gt; has_inactive(vnv)
true

julia&gt; length(vnv.vals)
4

julia&gt; contiguify!(vnv);

julia&gt; has_inactive(vnv)
false

julia&gt; length(vnv.vals)
3

julia&gt; vnv[@varname(x)]  # All the values are still there.
2-element Vector{Float64}:
 23.0
 24.0</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/DynamicPPL.jl/blob/0d947a8eeeffa1ee0b6af5f85f60c391b193f5d1/src/varnamedvector.jl#L1279-L1312">source</a></section></article><p>For example, one might encounter the following scenario:</p><pre><code class="language-julia hljs">vnv = DynamicPPL.VarNamedVector(@varname(x) =&gt; [true])
println(&quot;Before insertion: number of allocated entries  $(DynamicPPL.num_allocated(vnv))&quot;)

for i in 1:5
    x = fill(true, rand(1:100))
    DynamicPPL.update!(vnv, x, @varname(x))
    println(
        &quot;After insertion #$(i) of length $(length(x)): number of allocated entries  $(DynamicPPL.num_allocated(vnv))&quot;,
    )
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Before insertion: number of allocated entries  1
After insertion #1 of length 66: number of allocated entries  66
After insertion #2 of length 77: number of allocated entries  77
After insertion #3 of length 85: number of allocated entries  85
After insertion #4 of length 38: number of allocated entries  85
After insertion #5 of length 56: number of allocated entries  85</code></pre><p>We can then insert a call to <a href="#DynamicPPL.contiguify!"><code>DynamicPPL.contiguify!</code></a> after every insertion whenever the allocation grows too large to reduce overall memory usage:</p><pre><code class="language-julia hljs">vnv = DynamicPPL.VarNamedVector(@varname(x) =&gt; [true])
println(&quot;Before insertion: number of allocated entries  $(DynamicPPL.num_allocated(vnv))&quot;)

for i in 1:5
    x = fill(true, rand(1:100))
    DynamicPPL.update!(vnv, x, @varname(x))
    if DynamicPPL.num_allocated(vnv) &gt; 10
        DynamicPPL.contiguify!(vnv)
    end
    println(
        &quot;After insertion #$(i) of length $(length(x)): number of allocated entries  $(DynamicPPL.num_allocated(vnv))&quot;,
    )
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Before insertion: number of allocated entries  1
After insertion #1 of length 30: number of allocated entries  30
After insertion #2 of length 1: number of allocated entries  1
After insertion #3 of length 76: number of allocated entries  76
After insertion #4 of length 5: number of allocated entries  5
After insertion #5 of length 88: number of allocated entries  88</code></pre><p>This does incur a runtime cost as it requires re-allocation of the <code>ranges</code> in addition to a <code>resize!</code> of the underlying <code>Vector{T}</code>. However, this also ensures that the the underlying <code>Vector{T}</code> is contiguous, which is important for performance. Hence, if we&#39;re about to do a lot of work with the <code>VarNamedVector</code> without insertions, etc., it can be worth it to do a sweep to ensure that the underlying <code>Vector{T}</code> is contiguous.</p><div class="admonition is-info" id="Note-e3de4961247426a5"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-e3de4961247426a5" title="Permalink"></a></header><div class="admonition-body"><p>Higher-dimensional arrays, e.g. <code>Matrix</code>, are handled by simply vectorizing them before storing them in the <code>Vector{T}</code>, and composing the <code>VarName</code>&#39;s transformation with a <code>DynamicPPL.ReshapeTransform</code>.</p></div></div><p>Continuing from the example from the previous section, we can use a <code>VarInfo</code> with a <code>VarNamedVector</code> as the <code>metadata</code> field:</p><pre><code class="language-julia hljs"># Type-unstable
varinfo_untyped_vnv = DynamicPPL.untyped_vector_varinfo(varinfo_untyped)
varinfo_untyped_vnv[@varname(x)], varinfo_untyped_vnv[@varname(y)]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(Real[false, false], -2.2702371886488093)</code></pre><pre><code class="language-julia hljs"># Type-stable
varinfo_typed_vnv = DynamicPPL.typed_vector_varinfo(varinfo_typed)
varinfo_typed_vnv[@varname(x)], varinfo_typed_vnv[@varname(y)]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(Bool[1, 1], -1.7666742497380907)</code></pre><p>If we now try to <code>delete!</code> <code>@varname(x)</code></p><pre><code class="language-julia hljs">haskey(varinfo_untyped_vnv, @varname(x))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">true</code></pre><pre><code class="language-julia hljs">DynamicPPL.has_inactive(varinfo_untyped_vnv.metadata)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">false</code></pre><pre><code class="language-julia hljs"># `delete!`
DynamicPPL.delete!(varinfo_untyped_vnv.metadata, @varname(x))
DynamicPPL.has_inactive(varinfo_untyped_vnv.metadata)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">false</code></pre><pre><code class="language-julia hljs">haskey(varinfo_untyped_vnv, @varname(x))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">false</code></pre><p>Or insert a differently-sized value for <code>@varname(x)</code></p><pre><code class="language-julia hljs">DynamicPPL.insert!(varinfo_untyped_vnv.metadata, fill(true, 1), @varname(x))
varinfo_untyped_vnv[@varname(x)]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1-element Vector{Real}:
 true</code></pre><pre><code class="language-julia hljs">DynamicPPL.num_allocated(varinfo_untyped_vnv.metadata, @varname(x))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1</code></pre><pre><code class="language-julia hljs">DynamicPPL.update!(varinfo_untyped_vnv.metadata, fill(true, 4), @varname(x))
varinfo_untyped_vnv[@varname(x)]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">4-element Vector{Real}:
 true
 true
 true
 true</code></pre><pre><code class="language-julia hljs">DynamicPPL.num_allocated(varinfo_untyped_vnv.metadata, @varname(x))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">4</code></pre><h3 id="Performance-summary"><a class="docs-heading-anchor" href="#Performance-summary">Performance summary</a><a id="Performance-summary-1"></a><a class="docs-heading-anchor-permalink" href="#Performance-summary" title="Permalink"></a></h3><p>In the end, we have the following &quot;rough&quot; performance characteristics for <code>VarNamedVector</code>:</p><table><tr><th style="text-align: center">Method</th><th style="text-align: center">Is blazingly fast?</th></tr><tr><td style="text-align: center"><code>getindex</code></td><td style="text-align: center"><span>${\color{green} \checkmark}$</span></td></tr><tr><td style="text-align: center"><code>setindex!</code> on a new <code>VarName</code></td><td style="text-align: center"><span>${\color{green} \checkmark}$</span></td></tr><tr><td style="text-align: center"><code>delete!</code></td><td style="text-align: center"><span>${\color{red} \times}$</span></td></tr><tr><td style="text-align: center"><code>update!</code> on existing <code>VarName</code></td><td style="text-align: center"><span>${\color{green} \checkmark}$</span> if smaller or same size / <span>${\color{red} \times}$</span> if larger size</td></tr><tr><td style="text-align: center"><code>values_as(::VarNamedVector, Vector{T})</code></td><td style="text-align: center"><span>${\color{green} \checkmark}$</span> if contiguous / <span>${\color{orange} \div}$</span> otherwise</td></tr></table><h2 id="Other-methods"><a class="docs-heading-anchor" href="#Other-methods">Other methods</a><a id="Other-methods-1"></a><a class="docs-heading-anchor-permalink" href="#Other-methods" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DynamicPPL.replace_raw_storage-Tuple{DynamicPPL.VarNamedVector, AbstractVector}" href="#DynamicPPL.replace_raw_storage-Tuple{DynamicPPL.VarNamedVector, AbstractVector}"><code>DynamicPPL.replace_raw_storage</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">replace_raw_storage(vnv::VarNamedVector, vals::AbstractVector)</code></pre><p>Replace the values in <code>vnv</code> with <code>vals</code>, as they are stored internally.</p><p>This is useful when we want to update the entire underlying vector of values in one go or if we want to change the how the values are stored, e.g. alter the <code>eltype</code>.</p><div class="admonition is-warning" id="Warning-9156df927ddde137"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-9156df927ddde137" title="Permalink"></a></header><div class="admonition-body"><p>This replaces the raw underlying values, and so care should be taken when using this function. For example, if <code>vnv</code> has any inactive entries, then the provided <code>vals</code> should also contain the inactive entries to avoid unexpected behavior.</p></div></div><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; using DynamicPPL: VarNamedVector, replace_raw_storage

julia&gt; vnv = VarNamedVector(@varname(x) =&gt; [1.0]);

julia&gt; replace_raw_storage(vnv, [2.0])[@varname(x)] == [2.0]
true</code></pre><p>This is also useful when we want to differentiate wrt. the values using automatic differentiation, e.g. ForwardDiff.jl.</p><pre><code class="language-julia-repl hljs">julia&gt; using ForwardDiff: ForwardDiff

julia&gt; f(x) = sum(abs2, replace_raw_storage(vnv, x)[@varname(x)])
f (generic function with 1 method)

julia&gt; ForwardDiff.gradient(f, [1.0])
1-element Vector{Float64}:
 2.0</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/DynamicPPL.jl/blob/0d947a8eeeffa1ee0b6af5f85f60c391b193f5d1/src/varnamedvector.jl#L977-L1014">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DynamicPPL.values_as-Tuple{DynamicPPL.VarNamedVector}-internals-varinfo" href="#DynamicPPL.values_as-Tuple{DynamicPPL.VarNamedVector}-internals-varinfo"><code>DynamicPPL.values_as</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">values_as(vnv::VarNamedVector[, T])</code></pre><p>Return the values/realizations in <code>vnv</code> as type <code>T</code>, if implemented.</p><p>If no type <code>T</code> is provided, return values as stored in <code>vnv</code>.</p><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; using DynamicPPL: VarNamedVector

julia&gt; vnv = VarNamedVector(@varname(x) =&gt; 1, @varname(y) =&gt; [2.0]);

julia&gt; values_as(vnv) == [1.0, 2.0]
true

julia&gt; values_as(vnv, Vector{Float32}) == Vector{Float32}([1.0, 2.0])
true

julia&gt; values_as(vnv, OrderedDict) == OrderedDict(@varname(x) =&gt; 1.0, @varname(y) =&gt; [2.0])
true

julia&gt; values_as(vnv, NamedTuple) == (x = 1.0, y = [2.0])
true</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/DynamicPPL.jl/blob/0d947a8eeeffa1ee0b6af5f85f60c391b193f5d1/src/varnamedvector.jl#L1436-L1462">source</a></section></article><script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
mermaid.initialize({
    startOnLoad: true,
    theme: "neutral"
});
</script></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../api/">« API</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Monday 29 September 2025 14:25">Monday 29 September 2025</span>. Using Julia version 1.11.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
